<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¸”ë™ì•„ì›ƒ ê°€ë””ì–¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #000;
            min-height: 100vh;
            overflow: hidden;
        }
        
        /* ë©”ì¸ í™”ë©´ */
        #mainScreen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: relative;
        }
        
        /* ì„¤ì • ì•„ì´ì½˜ (ìš°ì¸¡ ìƒë‹¨) */
        .settings-icon {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 24px;
            transition: all 0.3s;
            z-index: 100;
        }
        
        .settings-icon:hover {
            background: rgba(255,255,255,0.5);
            transform: scale(1.1);
        }
        
        /* ê¸´ê¸‰ ë²„íŠ¼ (ë©”ì¸) */
        .emergency-btn {
            width: 280px;
            height: 280px;
            background: #ff1744;
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 20px 60px rgba(255, 23, 68, 0.5);
            transition: all 0.3s;
            animation: pulse 2s infinite;
            text-align: center;
            line-height: 1.3;
            padding: 20px;
        }
        
        .emergency-btn:active {
            transform: scale(0.95);
        }
        
        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 20px 60px rgba(255, 23, 68, 0.5);
            }
            50% {
                box-shadow: 0 20px 80px rgba(255, 23, 68, 0.8);
            }
        }
        
        /* ì„¤ì • í™”ë©´ */
        #settingsScreen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 200;
            overflow-y: auto;
            padding: 20px;
        }
        
        #settingsScreen.active {
            display: block;
        }
        
        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }
        
        .settings-header h2 {
            font-size: 28px;
            color: #333;
        }
        
        .close-btn {
            font-size: 32px;
            background: none;
            border: none;
            cursor: pointer;
            color: #666;
        }
        
        .contact-group {
            margin-bottom: 20px;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 15px;
        }
        
        .contact-group h3 {
            font-size: 18px;
            margin-bottom: 10px;
            color: #555;
        }
        
        .contact-input {
            width: 100%;
            padding: 15px;
            font-size: 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .contact-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .save-btn {
            width: 100%;
            padding: 18px;
            font-size: 22px;
            font-weight: bold;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            margin-top: 20px;
        }
        
        .save-btn:active {
            background: #45a049;
        }
        
        .info-box {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 4px solid #2196F3;
        }
        
        .info-box p {
            color: #1976D2;
            font-size: 14px;
            line-height: 1.6;
        }
        
        /* ê²€ì€ í™”ë©´ (SMS ì „ì†¡ í›„) */
        #blackScreen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 300;
        }
        
        #blackScreen.active {
            display: block;
        }
        
        /* ìƒíƒœ í‘œì‹œ (ì‘ê²Œ) */
        .status-indicator {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 20px;
            color: white;
            font-size: 14px;
            backdrop-filter: blur(10px);
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <!-- ë©”ì¸ í™”ë©´ -->
    <div id="mainScreen">
        <!-- ì„¤ì • ì•„ì´ì½˜ -->
        <div class="settings-icon" onclick="openSettings()">
            âš™ï¸
        </div>
        
        <!-- ê¸´ê¸‰ ë²„íŠ¼ -->
        <button class="emergency-btn" onclick="sendEmergencySMS()">
            ğŸš¨<br>
            ê¸´ê¸‰<br>
            êµ¬ì¡°
        </button>
        
        <!-- ìƒíƒœ í‘œì‹œ -->
        <div class="status-indicator" id="statusText">
            ì„¤ì •ì—ì„œ ì—°ë½ì²˜ë¥¼ ë“±ë¡í•˜ì„¸ìš”
        </div>
    </div>
    
    <!-- ì„¤ì • í™”ë©´ -->
    <div id="settingsScreen">
        <div class="settings-header">
            <h2>âš™ï¸ ë¹„ìƒ ì—°ë½ì²˜ ì„¤ì •</h2>
            <button class="close-btn" onclick="closeSettings()">âœ•</button>
        </div>
        
        <div class="contact-group">
            <h3>ğŸ“± ì—°ë½ì²˜ 1 (í•„ìˆ˜)</h3>
            <input type="tel" class="contact-input" id="contact1" placeholder="01012345678" maxlength="11">
        </div>
        
        <div class="contact-group">
            <h3>ğŸ“± ì—°ë½ì²˜ 2</h3>
            <input type="tel" class="contact-input" id="contact2" placeholder="01023456789" maxlength="11">
        </div>
        
        <div class="contact-group">
            <h3>ğŸ“± ì—°ë½ì²˜ 3</h3>
            <input type="tel" class="contact-input" id="contact3" placeholder="01034567890" maxlength="11">
        </div>
        
        <div class="contact-group">
            <h3>ğŸ“± ì—°ë½ì²˜ 4</h3>
            <input type="tel" class="contact-input" id="contact4" placeholder="01045678901" maxlength="11">
        </div>
        
        <div class="contact-group">
            <h3>ğŸ“± ì—°ë½ì²˜ 5</h3>
            <input type="tel" class="contact-input" id="contact5" placeholder="01056789012" maxlength="11">
        </div>
        
        <button class="save-btn" onclick="saveContacts()">
            ğŸ’¾ ì €ì¥í•˜ê¸°
        </button>
        
        <div class="info-box">
            <p>
                <strong>ğŸ’¡ ì‚¬ìš© ì•ˆë‚´</strong><br>
                â€¢ ìµœì†Œ 1ê°œì˜ ì—°ë½ì²˜ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤<br>
                â€¢ ì „í™”ë²ˆí˜¸ëŠ” í•˜ì´í”ˆ(-) ì—†ì´ ìˆ«ìë§Œ ì…ë ¥í•˜ì„¸ìš”<br>
                â€¢ ê¸´ê¸‰ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì¦‰ì‹œ ë¬¸ì ì•±ì´ ì—´ë¦½ë‹ˆë‹¤<br>
                â€¢ ë¬¸ì ì „ì†¡ í›„ í™”ë©´ì´ ê²€ì€ìƒ‰ìœ¼ë¡œ ë³€í•©ë‹ˆë‹¤
            </p>
        </div>
    </div>
    
    <!-- ê²€ì€ í™”ë©´ (SMS ì „ì†¡ í›„) -->
    <div id="blackScreen"></div>
    
    <script>
        // ========== ì „ì—­ ë³€ìˆ˜ ==========
        let currentLocation = null;
        
        // ========== í˜ì´ì§€ ë¡œë“œ ì‹œ ==========
        window.onload = function() {
            loadSavedContacts();
            getLocation();
            updateStatus();
        };
        
        // ========== ìœ„ì¹˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ê³ ì •ë°€) ==========
        function getLocation() {
            if (!navigator.geolocation) {
                console.log('ìœ„ì¹˜ ì„œë¹„ìŠ¤ ë¯¸ì§€ì›');
                currentLocation = { lat: 37.5665, lng: 126.9780 }; // ê¸°ë³¸ê°’
                return;
            }
            
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    currentLocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    console.log('ìœ„ì¹˜ í™•ì¸:', currentLocation);
                },
                function(error) {
                    console.log('ìœ„ì¹˜ ì˜¤ë¥˜:', error.message);
                    currentLocation = { lat: 37.5665, lng: 126.9780 }; // ê¸°ë³¸ê°’
                },
                {
                    enableHighAccuracy: true,  // ê³ ì •ë°€ GPS
                    timeout: 15000,
                    maximumAge: 0
                }
            );
        }
        
        // ========== ì €ì¥ëœ ì—°ë½ì²˜ ë¶ˆëŸ¬ì˜¤ê¸° ==========
        function loadSavedContacts() {
            for (let i = 1; i <= 5; i++) {
                const saved = localStorage.getItem('contact' + i);
                if (saved) {
                    document.getElementById('contact' + i).value = saved;
                }
            }
        }
        
        // ========== ì—°ë½ì²˜ ì €ì¥ ==========
        function saveContacts() {
            let savedCount = 0;
            
            for (let i = 1; i <= 5; i++) {
                const contact = document.getElementById('contact' + i).value.trim();
                if (contact) {
                    localStorage.setItem('contact' + i, contact);
                    savedCount++;
                }
            }
            
            if (savedCount === 0) {
                alert('âš ï¸ ìµœì†Œ 1ê°œì˜ ì—°ë½ì²˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }
            
            alert('âœ… ' + savedCount + 'ê°œì˜ ì—°ë½ì²˜ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
            updateStatus();
            closeSettings();
        }
        
        // ========== ê¸´ê¸‰ SMS ì „ì†¡ ==========
        function sendEmergencySMS() {
            // ìœ„ì¹˜ ì •ë³´ ë‹¤ì‹œ í™•ì¸
            getLocation();
            
            // ì €ì¥ëœ ì—°ë½ì²˜ ìˆ˜ì§‘
            const contacts = [];
            for (let i = 1; i <= 5; i++) {
                const contact = localStorage.getItem('contact' + i);
                if (contact) {
                    contacts.push(contact);
                }
            }
            
            if (contacts.length === 0) {
                alert('âš ï¸ ë¨¼ì € ì„¤ì •ì—ì„œ ì—°ë½ì²˜ë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš”!');
                openSettings();
                return;
            }
            
            // ìœ„ì¹˜ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ì‚¬ìš©
            if (!currentLocation) {
                currentLocation = { lat: 37.5665, lng: 126.9780 };
            }
            
            // êµ¬ê¸€ë§µ ë§í¬ ìƒì„±
            const mapLink = 'https://maps.google.com/?q=' + currentLocation.lat + ',' + currentLocation.lng;
            
            // ë©”ì‹œì§€ ë‚´ìš©
            const message = 'í†µí™”í• ìˆ˜ì—†ëŠ”ê¸´ê¸‰ìƒí™©! ë‚´ ìœ„ì¹˜ í™•ì¸í•˜ê³  ë„ì™€ì¤˜. ' + mapLink;
            
            // SMS ë§í¬ ìƒì„± (Android & iOS í˜¸í™˜)
            let smsLink;
            
            // iOS ë°©ì‹ ì‹œë„
            const recipientsIOS = contacts.join(',');
            smsLink = 'sms:' + recipientsIOS + '&body=' + encodeURIComponent(message);
            
            // Android ë°©ì‹ë„ ì¤€ë¹„ (fallback)
            const recipientsAndroid = contacts.join(';');
            const smsLinkAndroid = 'sms:' + recipientsAndroid + '?body=' + encodeURIComponent(message);
            
            // ì¦‰ì‹œ SMS ì•± ì—´ê¸°
            try {
                window.location.href = smsLink;
            } catch (e) {
                // iOS ì‹¤íŒ¨ ì‹œ Android ë°©ì‹ ì‹œë„
                window.location.href = smsLinkAndroid;
            }
            
            // 0.5ì´ˆ í›„ ê²€ì€ í™”ë©´ í™œì„±í™”
            setTimeout(function() {
                activateBlackScreen();
            }, 500);
        }
        
        // ========== ê²€ì€ í™”ë©´ í™œì„±í™” ==========
        function activateBlackScreen() {
            document.getElementById('blackScreen').classList.add('active');
            
            // ì§„ë™ (ì§€ì›ë˜ëŠ” ê²½ìš°)
            if (navigator.vibrate) {
                navigator.vibrate([300, 100, 300]);
            }
        }
        
        // ========== ê²€ì€ í™”ë©´ ë¹„í™œì„±í™” (ë’¤ë¡œê°€ê¸° ì‹œ) ==========
        function deactivateBlackScreen() {
            document.getElementById('blackScreen').classList.remove('active');
        }
        
        // ========== ì„¤ì • í™”ë©´ ì—´ê¸° ==========
        function openSettings() {
            document.getElementById('settingsScreen').classList.add('active');
        }
        
        // ========== ì„¤ì • í™”ë©´ ë‹«ê¸° ==========
        function closeSettings() {
            document.getElementById('settingsScreen').classList.remove('active');
        }
        
        // ========== ìƒíƒœ ì—…ë°ì´íŠ¸ ==========
        function updateStatus() {
            const contact1 = localStorage.getItem('contact1');
            const statusText = document.getElementById('statusText');
            
            if (contact1) {
                statusText.textContent = 'ê¸´ê¸‰ ì—°ë½ì²˜ ë“±ë¡ë¨ âœ…';
            } else {
                statusText.textContent = 'ì„¤ì •ì—ì„œ ì—°ë½ì²˜ë¥¼ ë“±ë¡í•˜ì„¸ìš”';
            }
        }
        
        // ========== ë’¤ë¡œê°€ê¸° ë²„íŠ¼ ì²˜ë¦¬ ==========
        window.addEventListener('popstate', function(event) {
            // ê²€ì€ í™”ë©´ í™œì„±í™”ë˜ì–´ ìˆìœ¼ë©´ ë¹„í™œì„±í™”
            if (document.getElementById('blackScreen').classList.contains('active')) {
                deactivateBlackScreen();
            }
            
            // ì„¤ì • í™”ë©´ ì—´ë ¤ìˆìœ¼ë©´ ë‹«ê¸°
            if (document.getElementById('settingsScreen').classList.contains('active')) {
                closeSettings();
            }
        });
        
        // ========== í™”ë©´ í„°ì¹˜ë¡œ ê²€ì€ í™”ë©´ í•´ì œ (ì„ íƒì ) ==========
        document.getElementById('blackScreen').addEventListener('click', function() {
            deactivateBlackScreen();
        });
    </script>
</body>
</html>
