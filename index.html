<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ì•ˆì „ì§€ëŒ€ ë°œì‹ ì†Œ V2.5</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: sans-serif; }
        body { height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); color: white; text-align: center; padding: 20px; }
        .card { background: rgba(255,255,255,0.1); padding: 25px; border-radius: 20px; width: 100%; max-width: 400px; margin-bottom: 20px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); }
        .id-text { font-size: 32px; color: #ffd700; font-weight: 900; margin: 10px 0; letter-spacing: 2px; }
        .btn-emergency { width: 100%; max-width: 350px; padding: 25px; font-size: 28px; font-weight: 900; color: white; background: #ff4757; border: none; border-radius: 50px; cursor: pointer; box-shadow: 0 10px 20px rgba(0,0,0,0.3); transition: 0.2s; }
        .btn-emergency:active { transform: scale(0.95); background: #ff0844; }
    </style>
</head>
<body>

    <div class="card">
        <p style="opacity: 0.8;">ë‚˜ì˜ ë°œì‹  ID (ìˆ˜ì‹ ìì—ê²Œ ì•Œë ¤ì£¼ì„¸ìš”)</p>
        <div id="myIDDisplay" class="id-text">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
    </div>

    <button class="btn-emergency" onclick="startEmergency()">ğŸš¨ ê¸´ê¸‰ êµ¬ì¡° ìš”ì²­</button>
    <p style="margin-top: 20px; opacity: 0.6;">ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ë‚´ ì „ìš© ì±„ë„ë¡œ ì‹ í˜¸ê°€ ì „ì†¡ë©ë‹ˆë‹¤.</p>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
        import { getDatabase, ref, set, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

        // [ì¤‘ìš”] ì—¬ê¸°ì— ìŠ¤ë¥´ì‚¬ë§ˆì˜ Firebase ì„¤ì •ê°’ì„ ê¼­ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”!
        const firebaseConfig = {
            apiKey: "AIzaSyCJnlwuftFUmmazQg-riYRewSeKRjBB8g",
            databaseURL: "https://safezone-2c1b2-default-rtdb.firebaseio.com",
            projectId: "safezone-2c1b2",
            appId: "1:181205095456:web:da0a519ff43cc19e7b1845"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // ë‚´ ê³ ìœ  ID ìƒì„± (SZ-XXXX)
        let myID = localStorage.getItem('safeZoneID_SND');
        if (!myID) {
            myID = 'SZ-' + Math.random().toString(36).substr(2, 4).toUpperCase();
            localStorage.setItem('safeZoneID_SND', myID);
        }
        document.getElementById('myIDDisplay').innerText = myID;

        window.startEmergency = function() {
            // ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” ì—¬ê¸°ì— GPS ì£¼ì†Œ ì¶”ì¶œ ì½”ë“œê°€ ë“¤ì–´ê°‘ë‹ˆë‹¤.
            // ì—°ìŠµìš©ìœ¼ë¡œ ì„ì‹œ ë°ì´í„°ë¥¼ ë‚´ ì•„ì´ë”” ë°©ì— ì €ì¥í•©ë‹ˆë‹¤.
            const myPath = ref(db, 'emergency_signals/' + myID);
            
            set(myPath, {
                sender: myID,
                address: "í…ŒìŠ¤íŠ¸ ìœ„ì¹˜ (ê´‘ì£¼ê´‘ì—­ì‹œ ë¶êµ¬)",
                lat: 35.1595,
                lon: 126.8526,
                mapUrl: "https://map.kakao.com/link/map/í…ŒìŠ¤íŠ¸ìœ„ì¹˜,35.1595,126.8526",
                time: new Date().toLocaleString(),
                timestamp: serverTimestamp()
            }).then(() => {
                alert("ê¸´ê¸‰ ì‹ í˜¸ê°€ ë‚´ ì±„ë„(" + myID + ")ë¡œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤!");
            });
        };
    </script>
</body>
</html>
