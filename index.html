<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ìŠ¤ë§ˆíŠ¸ ì•ˆì‹¬ ë„¤íŠ¸ì›Œí¬ â€” ê´€ë¦¬ì ë°ëª¨</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600;700&family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #060d1a;
  --bg2: #0c1829;
  --bg3: #111f35;
  --border: rgba(0,180,255,0.15);
  --border2: rgba(0,180,255,0.3);
  --accent: #00b4ff;
  --accent2: #0066cc;
  --green: #00ff88;
  --red: #ff3333;
  --yellow: #ffcc00;
  --text: #e0f0ff;
  --text2: rgba(200,230,255,0.6);
  --mono: 'IBM Plex Mono', monospace;
  --sans: 'Noto Sans KR', sans-serif;
}

*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
html, body { width:100%; height:100%; background:var(--bg); color:var(--text); font-family:var(--sans); overflow:hidden; }

/* â”€â”€â”€ SCANLINE OVERLAY â”€â”€â”€ */
body::after {
  content:''; position:fixed; inset:0; pointer-events:none; z-index:9999;
  background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.04) 2px, rgba(0,0,0,0.04) 4px);
}

/* â”€â”€â”€ SCREENS â”€â”€â”€ */
.screen { position:absolute; inset:0; display:none; flex-direction:column; }
.screen.active { display:flex; }

/* â”€â”€â”€ TOPBAR â”€â”€â”€ */
.topbar {
  flex-shrink:0; height:52px; background:rgba(6,13,26,0.98);
  border-bottom:1px solid var(--border2);
  display:flex; align-items:center; justify-content:space-between; padding:0 20px;
  backdrop-filter:blur(10px);
}
.topbar-left { display:flex; align-items:center; gap:12px; }
.logo-badge {
  background:var(--accent2); color:white; font-family:var(--mono); font-size:10px;
  font-weight:700; padding:3px 8px; border-radius:3px; letter-spacing:1px;
}
.topbar-title { font-size:14px; font-weight:700; color:var(--text); letter-spacing:0.5px; }
.topbar-right { display:flex; align-items:center; gap:16px; }
.live-badge {
  display:flex; align-items:center; gap:6px; font-family:var(--mono); font-size:11px; color:var(--green);
}
.live-dot { width:6px; height:6px; border-radius:50%; background:var(--green); animation:livePulse 1.2s ease-in-out infinite; }
@keyframes livePulse { 0%,100%{opacity:1;box-shadow:0 0 0 0 rgba(0,255,136,0.4);} 50%{opacity:0.6;box-shadow:0 0 0 4px rgba(0,255,136,0);} }
.clock { font-family:var(--mono); font-size:12px; color:var(--text2); }

/* â”€â”€â”€ BREADCRUMB â”€â”€â”€ */
.breadcrumb {
  flex-shrink:0; height:38px; background:var(--bg2);
  border-bottom:1px solid var(--border);
  display:flex; align-items:center; padding:0 20px; gap:6px;
  font-family:var(--mono); font-size:11px; color:var(--text2);
}
.bc-item { cursor:pointer; transition:color 0.2s; }
.bc-item:hover { color:var(--accent); }
.bc-item.active { color:var(--accent); font-weight:600; }
.bc-sep { color:rgba(0,180,255,0.3); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCREEN 1 â€” L0 SUPER ADMIN NAVIGATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#navScreen { background: radial-gradient(ellipse at 20% 50%, rgba(0,60,120,0.15) 0%, transparent 60%), var(--bg); }

.nav-body { flex:1; display:flex; overflow:hidden; }

/* Left sidebar â€” level selector */
.nav-sidebar {
  width:200px; flex-shrink:0; background:var(--bg2);
  border-right:1px solid var(--border); padding:16px 0;
  display:flex; flex-direction:column; gap:2px; overflow-y:auto;
}
.level-tab {
  padding:12px 20px; cursor:pointer; transition:all 0.2s;
  display:flex; align-items:center; gap:10px;
  border-left:3px solid transparent;
  font-size:13px; font-weight:500; color:var(--text2);
}
.level-tab:hover { background:rgba(0,180,255,0.06); color:var(--text); }
.level-tab.active { background:rgba(0,180,255,0.1); border-left-color:var(--accent); color:var(--accent); font-weight:700; }
.level-badge {
  font-family:var(--mono); font-size:9px; font-weight:700;
  padding:2px 6px; border-radius:3px; background:rgba(0,180,255,0.15);
  color:var(--accent); letter-spacing:0.5px;
}

/* Main panel */
.nav-main { flex:1; overflow:hidden; display:flex; flex-direction:column; }

.nav-panel-header {
  flex-shrink:0; padding:16px 24px 12px;
  border-bottom:1px solid var(--border);
  display:flex; align-items:center; justify-content:space-between;
}
.nav-panel-title { font-size:18px; font-weight:900; letter-spacing:-0.3px; }
.nav-panel-count { font-family:var(--mono); font-size:12px; color:var(--text2); }

.nav-search {
  flex-shrink:0; padding:12px 24px;
  display:flex; gap:10px; align-items:center;
}
.search-input {
  flex:1; background:var(--bg3); border:1px solid var(--border2);
  border-radius:8px; padding:8px 14px; color:var(--text);
  font-family:var(--sans); font-size:13px; outline:none;
  transition:border-color 0.2s;
}
.search-input:focus { border-color:var(--accent); }
.search-input::placeholder { color:var(--text2); }

.nav-grid {
  flex:1; overflow-y:auto; padding:12px 24px 20px;
  display:grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap:10px;
  align-content:start;
}
.nav-grid::-webkit-scrollbar { width:4px; }
.nav-grid::-webkit-scrollbar-track { background:transparent; }
.nav-grid::-webkit-scrollbar-thumb { background:var(--border2); border-radius:4px; }

.nav-card {
  background:var(--bg3); border:1px solid var(--border);
  border-radius:10px; padding:14px 16px; cursor:pointer;
  transition:all 0.2s; position:relative; overflow:hidden;
}
.nav-card::before {
  content:''; position:absolute; inset:0; background:linear-gradient(135deg, rgba(0,180,255,0.04), transparent);
  opacity:0; transition:opacity 0.2s;
}
.nav-card:hover { border-color:var(--accent); transform:translateY(-1px); box-shadow:0 4px 20px rgba(0,180,255,0.12); }
.nav-card:hover::before { opacity:1; }
.nav-card.has-sos { border-color:rgba(255,51,51,0.5); animation:cardPulse 2s ease-in-out infinite; }
@keyframes cardPulse { 0%,100%{box-shadow:0 0 0 0 rgba(255,51,51,0);} 50%{box-shadow:0 0 12px rgba(255,51,51,0.3);} }

.card-label { font-size:13px; font-weight:700; color:var(--text); margin-bottom:6px; }
.card-sub { font-family:var(--mono); font-size:10px; color:var(--text2); margin-bottom:8px; }
.card-stats { display:flex; gap:8px; align-items:center; }
.stat-pill {
  font-family:var(--mono); font-size:9px; font-weight:600;
  padding:2px 7px; border-radius:10px;
}
.stat-green { background:rgba(0,255,136,0.1); color:var(--green); border:1px solid rgba(0,255,136,0.2); }
.stat-red { background:rgba(255,51,51,0.15); color:#ff6666; border:1px solid rgba(255,51,51,0.3); }
.stat-blue { background:rgba(0,180,255,0.1); color:var(--accent); border:1px solid rgba(0,180,255,0.2); }
.card-arrow { position:absolute; right:12px; top:50%; transform:translateY(-50%); color:var(--text2); font-size:14px; transition:all 0.2s; }
.nav-card:hover .card-arrow { color:var(--accent); transform:translateY(-50%) translateX(2px); }

/* Right stats panel */
.nav-stats {
  width:220px; flex-shrink:0; background:var(--bg2);
  border-left:1px solid var(--border); padding:16px;
  display:flex; flex-direction:column; gap:14px; overflow-y:auto;
}
.stats-section-title { font-family:var(--mono); font-size:10px; font-weight:700; color:var(--text2); letter-spacing:1px; text-transform:uppercase; margin-bottom:4px; }
.stat-row { display:flex; justify-content:space-between; align-items:center; padding:8px 0; border-bottom:1px solid var(--border); }
.stat-label { font-size:12px; color:var(--text2); }
.stat-value { font-family:var(--mono); font-size:14px; font-weight:700; color:var(--text); }
.stat-value.green { color:var(--green); }
.stat-value.red { color:var(--red); }
.stat-value.yellow { color:var(--yellow); }

.sos-alert-mini {
  background:rgba(255,51,51,0.1); border:1px solid rgba(255,51,51,0.3);
  border-radius:8px; padding:10px 12px; cursor:pointer;
  transition:all 0.2s; animation:miniPulse 1.5s ease-in-out infinite;
}
.sos-alert-mini:hover { background:rgba(255,51,51,0.2); }
@keyframes miniPulse { 0%,100%{opacity:1;} 50%{opacity:0.7;} }
.sos-mini-title { font-size:11px; font-weight:700; color:#ff6666; margin-bottom:4px; display:flex; align-items:center; gap:6px; }
.sos-mini-body { font-size:11px; color:var(--text2); line-height:1.5; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCREEN 2 â€” L3 RADAR CONTROL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#radarScreen { background: radial-gradient(ellipse at 70% 30%, rgba(0,40,80,0.3) 0%, transparent 60%), var(--bg); }

.radar-layout { flex:1; display:flex; overflow:hidden; }

/* Main radar area */
.radar-main { flex:1; display:flex; flex-direction:column; overflow:hidden; }

.radar-toolbar {
  flex-shrink:0; padding:10px 20px;
  border-bottom:1px solid var(--border);
  display:flex; align-items:center; gap:12px;
  background:var(--bg2);
}
.toolbar-search {
  flex:1; max-width:320px; background:var(--bg3);
  border:1px solid var(--border2); border-radius:8px;
  padding:7px 14px; color:var(--text); font-family:var(--sans); font-size:13px; outline:none;
  transition:border-color 0.2s;
}
.toolbar-search:focus { border-color:var(--accent); }
.toolbar-search::placeholder { color:var(--text2); }

.tb-btn {
  padding:7px 14px; border-radius:8px; border:1px solid var(--border2);
  background:var(--bg3); color:var(--text2); font-size:12px; font-weight:600;
  cursor:pointer; transition:all 0.2s; font-family:var(--sans); white-space:nowrap;
}
.tb-btn:hover { border-color:var(--accent); color:var(--accent); }
.tb-btn.active { background:rgba(0,180,255,0.15); border-color:var(--accent); color:var(--accent); }

.radar-canvas-wrap { flex:1; display:flex; align-items:center; justify-content:center; position:relative; overflow:hidden; }

.radar-grid-bg {
  position:absolute; inset:0; pointer-events:none;
  background-image:
    linear-gradient(var(--border) 1px, transparent 1px),
    linear-gradient(90deg, var(--border) 1px, transparent 1px);
  background-size:40px 40px;
}

.radar-circle-wrap { position:relative; width:420px; height:420px; }

.radar-ring-outer {
  position:absolute; inset:0; border-radius:50%;
  border:1px solid var(--border2);
  background:radial-gradient(circle, rgba(0,20,50,0.95) 0%, rgba(2,10,30,0.98) 100%);
  box-shadow:0 0 60px rgba(0,180,255,0.1), inset 0 0 60px rgba(0,0,0,0.5);
}
.radar-inner-ring {
  position:absolute; border-radius:50%; border:1px solid rgba(0,180,255,0.1);
}
.rir1 { inset:15%; }
.rir2 { inset:30%; }
.rir3 { inset:45%; }
.rir4 { inset:60%; }

.radar-cross-h, .radar-cross-v {
  position:absolute; background:rgba(0,180,255,0.12);
}
.radar-cross-h { top:50%; left:5%; right:5%; height:1px; }
.radar-cross-v { left:50%; top:5%; bottom:5%; width:1px; }

.radar-sweep {
  position:absolute; inset:0; border-radius:50%;
  animation:radarSpin 3s linear infinite;
  transform-origin:center;
}
.radar-sweep::after {
  content:''; position:absolute; inset:0; border-radius:50%;
  background:conic-gradient(from 270deg, rgba(0,180,255,0) 0deg, rgba(0,180,255,0.5) 40deg, rgba(0,180,255,0) 55deg);
}
@keyframes radarSpin { from{transform:rotate(0deg);} to{transform:rotate(360deg);} }

.radar-center { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:8px; height:8px; border-radius:50%; background:var(--accent); box-shadow:0 0 12px var(--accent); z-index:5; }

/* Dots */
.radar-dot {
  position:absolute; border-radius:50%; cursor:pointer; z-index:10;
  transform:translate(-50%,-50%); transition:all 0.3s;
  display:flex; align-items:center; justify-content:center;
}
.dot-normal { width:12px; height:12px; background:var(--green); box-shadow:0 0 8px var(--green); }
.dot-sos { width:14px; height:14px; background:var(--red); box-shadow:0 0 12px var(--red); animation:dotSOS 0.7s ease-in-out infinite; }
@keyframes dotSOS { 0%,100%{transform:translate(-50%,-50%) scale(1);} 50%{transform:translate(-50%,-50%) scale(1.5); box-shadow:0 0 20px var(--red);} }
.dot-warning { width:12px; height:12px; background:var(--yellow); box-shadow:0 0 8px var(--yellow); animation:dotWarn 1.2s ease-in-out infinite; }
@keyframes dotWarn { 0%,100%{opacity:1;} 50%{opacity:0.5;} }

.dot-tooltip {
  position:absolute; bottom:calc(100% + 8px); left:50%; transform:translateX(-50%);
  background:var(--bg3); border:1px solid var(--border2);
  border-radius:8px; padding:8px 12px; min-width:160px;
  font-size:11px; white-space:nowrap; pointer-events:none;
  display:none; z-index:100;
  box-shadow:0 4px 20px rgba(0,0,0,0.5);
}
.radar-dot:hover .dot-tooltip { display:block; }

/* Radar legend */
.radar-legend {
  position:absolute; bottom:16px; left:16px;
  display:flex; flex-direction:column; gap:5px;
}
.legend-row { display:flex; align-items:center; gap:8px; font-size:11px; color:var(--text2); }
.legend-dot { width:8px; height:8px; border-radius:50%; flex-shrink:0; }

/* Right sidebar â€” detail panel */
.radar-sidebar {
  width:280px; flex-shrink:0; background:var(--bg2);
  border-left:1px solid var(--border);
  display:flex; flex-direction:column; overflow:hidden;
}

.rs-header {
  flex-shrink:0; padding:14px 16px;
  border-bottom:1px solid var(--border);
  display:flex; align-items:center; justify-content:space-between;
}
.rs-title { font-size:13px; font-weight:700; }
.rs-count { font-family:var(--mono); font-size:11px; color:var(--text2); }

.rs-tabs { flex-shrink:0; display:flex; border-bottom:1px solid var(--border); }
.rs-tab {
  flex:1; padding:9px; text-align:center; font-size:11px; font-weight:600;
  color:var(--text2); cursor:pointer; transition:all 0.2s;
  border-bottom:2px solid transparent;
}
.rs-tab.active { color:var(--accent); border-bottom-color:var(--accent); background:rgba(0,180,255,0.05); }

.rs-content { flex:1; overflow-y:auto; padding:12px; display:flex; flex-direction:column; gap:8px; }
.rs-content::-webkit-scrollbar { width:3px; }
.rs-content::-webkit-scrollbar-thumb { background:var(--border2); border-radius:3px; }

/* Resident card in sidebar */
.res-card {
  background:var(--bg3); border:1px solid var(--border);
  border-radius:8px; padding:10px 12px; cursor:pointer;
  transition:all 0.2s;
}
.res-card:hover { border-color:var(--border2); background:rgba(0,180,255,0.04); }
.res-card.sos-card { border-color:rgba(255,51,51,0.4); background:rgba(255,20,20,0.06); animation:cardPulse 1.5s infinite; }
.res-header-row { display:flex; align-items:center; justify-content:space-between; margin-bottom:4px; }
.res-name { font-size:12px; font-weight:700; }
.res-status { font-family:var(--mono); font-size:9px; font-weight:700; padding:2px 7px; border-radius:10px; }
.res-id { font-family:var(--mono); font-size:10px; color:var(--text2); margin-bottom:2px; }
.res-addr { font-size:11px; color:var(--text2); }

/* Detail popup overlay */
.detail-popup {
  position:fixed; inset:0; z-index:8000; display:none;
  align-items:center; justify-content:center;
  background:rgba(0,0,0,0.7); backdrop-filter:blur(4px);
}
.detail-popup.visible { display:flex; }
.detail-card {
  background:var(--bg3); border:1px solid var(--border2);
  border-radius:16px; padding:24px; width:380px; max-width:90vw;
  box-shadow:0 20px 60px rgba(0,0,0,0.8), 0 0 40px rgba(0,180,255,0.1);
  animation:popIn 0.2s ease-out;
}
@keyframes popIn { from{transform:scale(0.9);opacity:0;} to{transform:scale(1);opacity:1;} }
.dc-top { display:flex; align-items:center; justify-content:space-between; margin-bottom:16px; }
.dc-title { font-size:16px; font-weight:900; }
.dc-close { cursor:pointer; color:var(--text2); font-size:20px; line-height:1; transition:color 0.2s; }
.dc-close:hover { color:white; }
.dc-id { font-family:var(--mono); font-size:11px; color:var(--accent); margin-bottom:16px; }
.dc-rows { display:flex; flex-direction:column; gap:0; border:1px solid var(--border); border-radius:8px; overflow:hidden; margin-bottom:16px; }
.dc-row { display:flex; border-bottom:1px solid var(--border); }
.dc-row:last-child { border-bottom:none; }
.dc-label { width:90px; flex-shrink:0; padding:9px 12px; background:rgba(0,180,255,0.05); font-size:11px; font-weight:600; color:var(--text2); display:flex; align-items:center; }
.dc-val { padding:9px 12px; font-size:12px; color:var(--text); flex:1; display:flex; align-items:center; }
.dc-actions { display:flex; gap:10px; }
.dc-btn {
  flex:1; padding:10px; border-radius:8px; border:none; cursor:pointer;
  font-family:var(--sans); font-size:12px; font-weight:700; transition:all 0.2s;
}
.dc-btn-track { background:rgba(0,180,255,0.15); border:1px solid var(--border2); color:var(--accent); }
.dc-btn-track:hover { background:rgba(0,180,255,0.25); }
.dc-btn-disconnect { background:rgba(255,51,51,0.1); border:1px solid rgba(255,51,51,0.3); color:#ff6666; }
.dc-btn-disconnect:hover { background:rgba(255,51,51,0.2); }

/* â”€â”€â”€ TRANSITIONS â”€â”€â”€ */
.screen { transition:none; }
.screen.slide-out { animation:slideOut 0.35s ease-in forwards; }
.screen.slide-in { animation:slideIn 0.35s ease-out forwards; }
@keyframes slideOut { to{ transform:translateX(-40px); opacity:0; } }
@keyframes slideIn { from{ transform:translateX(40px); opacity:0; } to{ transform:translateX(0); opacity:1; } }

/* â”€â”€â”€ BACK BUTTON â”€â”€â”€ */
.back-btn {
  padding:6px 14px; border-radius:8px; border:1px solid var(--border2);
  background:transparent; color:var(--text2); font-size:12px; font-weight:600;
  cursor:pointer; transition:all 0.2s; font-family:var(--sans);
  display:flex; align-items:center; gap:6px;
}
.back-btn:hover { border-color:var(--accent); color:var(--accent); }

/* â”€â”€â”€ SOS TOAST â”€â”€â”€ */
.sos-toast {
  position:fixed; top:60px; right:20px; z-index:9000;
  background:rgba(255,20,20,0.95); border:1px solid rgba(255,100,100,0.5);
  border-radius:12px; padding:12px 16px; min-width:260px;
  box-shadow:0 8px 32px rgba(255,0,0,0.3);
  display:none; animation:toastIn 0.3s ease-out;
  cursor:pointer;
}
.sos-toast.visible { display:block; }
@keyframes toastIn { from{transform:translateX(20px);opacity:0;} to{transform:translateX(0);opacity:1;} }
.toast-title { font-size:13px; font-weight:900; margin-bottom:4px; display:flex; align-items:center; gap:8px; }
.toast-body { font-size:11px; color:rgba(255,255,255,0.8); }

/* â”€â”€â”€ EMPTY STATE â”€â”€â”€ */
.rs-empty { text-align:center; color:var(--text2); font-size:12px; padding:30px 16px; }
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREEN 1 â€” L0 NAVIGATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="navScreen" class="screen active">
  <div class="topbar">
    <div class="topbar-left">
      <div class="logo-badge">ADMIN L0</div>
      <span class="topbar-title">ìŠ¤ë§ˆíŠ¸ ì•ˆì‹¬ ë„¤íŠ¸ì›Œí¬ â€” ì „êµ­ ê´€ì œ</span>
    </div>
    <div class="topbar-right">
      <div class="sos-toast" id="sosToast" onclick="goToSOS()">
        <div class="toast-title">ğŸš¨ SOS ìˆ˜ì‹  <span style="font-family:var(--mono);font-size:10px;font-weight:400;">ê´‘ì£¼ ë¶êµ¬ ì¤‘í¥ë™</span></div>
        <div class="toast-body">ê¹€â—‹ìˆ™ (AJS-GJ-NK-001) Â· í´ë¦­í•˜ì—¬ ì¦‰ì‹œ ì´ë™</div>
      </div>
      <div class="live-badge"><div class="live-dot"></div>LIVE</div>
      <div class="clock" id="clock">--:--:--</div>
    </div>
  </div>

  <div class="breadcrumb">
    <span class="bc-item active" id="bc0" onclick="drillTo(0)">ğŸ‡°ğŸ‡· ì „êµ­</span>
    <span class="bc-sep" id="bcSep1" style="display:none">â€º</span>
    <span class="bc-item" id="bc1" style="display:none" onclick="drillTo(1)"></span>
    <span class="bc-sep" id="bcSep2" style="display:none">â€º</span>
    <span class="bc-item" id="bc2" style="display:none" onclick="drillTo(2)"></span>
    <span class="bc-sep" id="bcSep3" style="display:none">â€º</span>
    <span class="bc-item" id="bc3" style="display:none"></span>
  </div>

  <div class="nav-body">
    <!-- Level tabs -->
    <div class="nav-sidebar">
      <div class="level-tab active" id="tabL0" onclick="drillTo(0)">
        <span class="level-badge">L0</span> ì „êµ­
      </div>
      <div class="level-tab" id="tabL1" onclick="drillTo(1)" style="opacity:0.3;pointer-events:none;">
        <span class="level-badge">L1</span> ì‹œÂ·ë„
      </div>
      <div class="level-tab" id="tabL2" onclick="drillTo(2)" style="opacity:0.3;pointer-events:none;">
        <span class="level-badge">L2</span> ì‹œÂ·êµ°Â·êµ¬
      </div>
      <div class="level-tab" id="tabL3" style="opacity:0.3;pointer-events:none;">
        <span class="level-badge">L3</span> ìÂ·ë©´Â·ë™
      </div>
      <div style="margin-top:auto; padding:16px; border-top:1px solid var(--border);">
        <div style="font-family:var(--mono);font-size:10px;color:var(--text2);line-height:1.8;">
          ì´ ë“±ë¡ ì–´ë¥´ì‹ <br>
          <span style="font-size:18px;font-weight:700;color:var(--green);" id="totalCount">2,847</span><br><br>
          SOS ì§„í–‰ ì¤‘<br>
          <span style="font-size:18px;font-weight:700;color:var(--red);" id="totalSOS">1</span>
        </div>
      </div>
    </div>

    <!-- Cards -->
    <div class="nav-main">
      <div class="nav-panel-header">
        <div class="nav-panel-title" id="panelTitle">ì‹œÂ·ë„ ì„ íƒ</div>
        <div class="nav-panel-count" id="panelCount"></div>
      </div>
      <div class="nav-search">
        <input class="search-input" id="navSearch" placeholder="ì§€ì—­ëª… ê²€ìƒ‰..." oninput="filterCards()">
      </div>
      <div class="nav-grid" id="navGrid"></div>
    </div>

    <!-- Stats panel -->
    <div class="nav-stats">
      <div>
        <div class="stats-section-title">ì „êµ­ í˜„í™©</div>
        <div class="stat-row"><span class="stat-label">ë“±ë¡ ì–´ë¥´ì‹ </span><span class="stat-value green">2,847</span></div>
        <div class="stat-row"><span class="stat-label">ì •ìƒ ìƒíƒœ</span><span class="stat-value green">2,846</span></div>
        <div class="stat-row"><span class="stat-label">SOS ì§„í–‰</span><span class="stat-value red">1</span></div>
        <div class="stat-row"><span class="stat-label">ê³µë¬´ì› ê³„ì •</span><span class="stat-value">89</span></div>
        <div class="stat-row"><span class="stat-label">ê´€í•  êµ¬ì—­</span><span class="stat-value">124</span></div>
      </div>
      <div>
        <div class="stats-section-title">ì‹¤ì‹œê°„ ì•Œë¦¼</div>
        <div class="sos-alert-mini" onclick="goToSOS()">
          <div class="sos-mini-title">ğŸš¨ SOS ë°œìƒ</div>
          <div class="sos-mini-body">ê´‘ì£¼ ë¶êµ¬ ì¤‘í¥ë™<br>ê¹€â—‹ìˆ™ Â· 1ë¶„ ì „</div>
        </div>
      </div>
      <div>
        <div class="stats-section-title">ë§ˆìŠ¤í„° ìŠ¤ìœ„ì¹˜</div>
        <div style="background:rgba(255,204,0,0.1);border:1px solid rgba(255,204,0,0.3);border-radius:8px;padding:10px 12px;">
          <div style="font-size:11px;color:var(--yellow);font-weight:700;margin-bottom:4px;">âš  ìœ„ì¹˜ ê¸°ëŠ¥ OFF</div>
          <div style="font-size:10px;color:var(--text2);line-height:1.5;">ë²•ì  ìŠ¹ì¸ ëŒ€ê¸° ì¤‘<br>ì„œë²„ ì„¤ì •ìœ¼ë¡œ ì¦‰ì‹œ ì „í™˜ ê°€ëŠ¥</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREEN 2 â€” L3 RADAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="radarScreen" class="screen">
  <div class="topbar">
    <div class="topbar-left">
      <button class="back-btn" onclick="goBack()">â† ëª©ë¡ìœ¼ë¡œ</button>
      <div class="logo-badge">RADAR L3</div>
      <span class="topbar-title" id="radarTitle">ì¤‘í¥ë™ ìŠ¤ë§ˆíŠ¸ ì•ˆì‹¬ ë„¤íŠ¸ì›Œí¬</span>
    </div>
    <div class="topbar-right">
      <div id="scaleLabel" style="font-family:var(--mono);font-size:11px;color:var(--text2);"></div>
      <div class="live-badge"><div class="live-dot"></div>LIVE</div>
      <div class="clock" id="clock2">--:--:--</div>
    </div>
  </div>

  <div class="breadcrumb">
    <span class="bc-item" onclick="goBack()">ğŸ‡°ğŸ‡· ì „êµ­</span>
    <span class="bc-sep">â€º</span>
    <span class="bc-item" onclick="goBack()" id="radarBC1">ê´‘ì£¼ê´‘ì—­ì‹œ</span>
    <span class="bc-sep">â€º</span>
    <span class="bc-item" onclick="goBack()" id="radarBC2">ë¶êµ¬</span>
    <span class="bc-sep">â€º</span>
    <span class="bc-item active" id="radarBC3">ì¤‘í¥ë™</span>
  </div>

  <div class="radar-layout">
    <!-- Radar area -->
    <div class="radar-main">
      <div class="radar-toolbar">
        <input class="toolbar-search" id="radarSearch" placeholder="ì´ë¦„ ë˜ëŠ” ì „í™”ë²ˆí˜¸ ë’·ìë¦¬..." oninput="filterDots()">
        <button class="tb-btn active" id="btnAll" onclick="setFilter('all')">ì „ì²´</button>
        <button class="tb-btn" id="btnSOS" onclick="setFilter('sos')">ğŸ”´ SOS</button>
        <button class="tb-btn" id="btnNormal" onclick="setFilter('normal')">ğŸŸ¢ ì •ìƒ</button>
        <div style="margin-left:auto;display:flex;gap:8px;">
          <button class="tb-btn" onclick="alert('QR ìŠ¤ìº” ê¸°ëŠ¥ â€” ê°œë°œ ì˜ˆì •')">ğŸ“· QR ë“±ë¡</button>
        </div>
      </div>
      <div class="radar-canvas-wrap">
        <div class="radar-grid-bg"></div>
        <div class="radar-circle-wrap" id="radarWrap">
          <div class="radar-ring-outer"></div>
          <div class="radar-inner-ring rir1"></div>
          <div class="radar-inner-ring rir2"></div>
          <div class="radar-inner-ring rir3"></div>
          <div class="radar-inner-ring rir4"></div>
          <div class="radar-cross-h"></div>
          <div class="radar-cross-v"></div>
          <div class="radar-sweep"></div>
          <div class="radar-center"></div>
          <!-- dots injected by JS -->
        </div>
        <div class="radar-legend">
          <div class="legend-row"><div class="legend-dot" style="background:var(--green);box-shadow:0 0 4px var(--green);"></div><span>ì •ìƒ</span></div>
          <div class="legend-row"><div class="legend-dot" style="background:var(--red);box-shadow:0 0 4px var(--red);animation:dotSOS 0.7s infinite;"></div><span>SOS ë°œìƒ</span></div>
          <div class="legend-row"><div class="legend-dot" style="background:var(--yellow);box-shadow:0 0 4px var(--yellow);"></div><span>ì£¼ì˜</span></div>
        </div>
      </div>
    </div>

    <!-- Right sidebar -->
    <div class="radar-sidebar">
      <div class="rs-header">
        <span class="rs-title" id="sidebarTitle">ê´€ë¦¬ ëª©ë¡</span>
        <span class="rs-count" id="sidebarCount"></span>
      </div>
      <div class="rs-tabs">
        <div class="rs-tab active" onclick="setSideTab('all')">ì „ì²´</div>
        <div class="rs-tab" onclick="setSideTab('sos')">ğŸš¨ SOS</div>
        <div class="rs-tab" onclick="setSideTab('normal')">ì •ìƒ</div>
      </div>
      <div class="rs-content" id="rsList"></div>
    </div>
  </div>
</div>

<!-- Detail Popup -->
<div class="detail-popup" id="detailPopup">
  <div class="detail-card">
    <div class="dc-top">
      <div class="dc-title" id="dcName">--</div>
      <div class="dc-close" onclick="closeDetail()">âœ•</div>
    </div>
    <div class="dc-id" id="dcId">--</div>
    <div class="dc-rows">
      <div class="dc-row"><div class="dc-label">ìƒíƒœ</div><div class="dc-val" id="dcStatus">--</div></div>
      <div class="dc-row"><div class="dc-label">ì—°ë½ì²˜</div><div class="dc-val" id="dcPhone">--</div></div>
      <div class="dc-row"><div class="dc-label">ìƒì„¸ì£¼ì†Œ</div><div class="dc-val" id="dcAddr">--</div></div>
      <div class="dc-row"><div class="dc-label">ë“±ë¡ì¼</div><div class="dc-val" id="dcReg">--</div></div>
      <div class="dc-row"><div class="dc-label">ìµœê·¼ SOS</div><div class="dc-val" id="dcLastSOS">--</div></div>
    </div>
    <div class="dc-actions">
      <button class="dc-btn dc-btn-track" onclick="alert('ì§€ë„ ì¶”ì  ê¸°ëŠ¥ â€” ê°œë°œ ì˜ˆì •')">ğŸ“ ìœ„ì¹˜ ì¶”ì </button>
      <button class="dc-btn dc-btn-disconnect" onclick="confirmDisconnect()">ì—°ê²° í•´ì œ</button>
    </div>
  </div>
</div>

<script>
// â”€â”€â”€ CLOCK â”€â”€â”€
function updateClock() {
  const now = new Date();
  const t = now.toTimeString().slice(0,8);
  document.getElementById('clock').textContent = t;
  const c2 = document.getElementById('clock2');
  if (c2) c2.textContent = t;
}
setInterval(updateClock, 1000); updateClock();

// â”€â”€â”€ DATA â”€â”€â”€
const hierarchy = {
  L1: [
    { code:'KR-29', name:'ê´‘ì£¼ê´‘ì—­ì‹œ', L2count:5, residents:423, sos:1 },
    { code:'KR-46', name:'ì „ë¼ë‚¨ë„', L2count:22, residents:1204, sos:0 },
    { code:'KR-11', name:'ì„œìš¸íŠ¹ë³„ì‹œ', L2count:25, residents:687, sos:0 },
    { code:'KR-26', name:'ë¶€ì‚°ê´‘ì—­ì‹œ', L2count:16, residents:312, sos:0 },
    { code:'KR-27', name:'ëŒ€êµ¬ê´‘ì—­ì‹œ', L2count:8, residents:221, sos:0 },
  ],
  'KR-29': [
    { code:'KR-29-110', name:'ê´‘ì£¼ ë¶êµ¬', L3count:17, residents:142, sos:1 },
    { code:'KR-29-120', name:'ê´‘ì£¼ ë™êµ¬', L3count:9, residents:87, sos:0 },
    { code:'KR-29-130', name:'ê´‘ì£¼ ì„œêµ¬', L3count:14, residents:98, sos:0 },
    { code:'KR-29-140', name:'ê´‘ì£¼ ë‚¨êµ¬', L3count:11, residents:62, sos:0 },
    { code:'KR-29-150', name:'ê´‘ì£¼ ê´‘ì‚°êµ¬', L3count:19, residents:34, sos:0 },
  ],
  'KR-46': [
    { code:'KR-46-380', name:'ë‹´ì–‘êµ°', L3count:12, residents:87, sos:0 },
    { code:'KR-46-390', name:'ê³¡ì„±êµ°', L3count:9, residents:64, sos:0 },
    { code:'KR-46-400', name:'êµ¬ë¡€êµ°', L3count:7, residents:48, sos:0 },
  ],
  'KR-11': [
    { code:'KR-11-110', name:'ì¢…ë¡œêµ¬', L3count:17, residents:42, sos:0 },
    { code:'KR-11-140', name:'ì¤‘êµ¬', L3count:15, residents:38, sos:0 },
    { code:'KR-11-170', name:'ìš©ì‚°êµ¬', L3count:16, residents:51, sos:0 },
  ],
  'KR-26': [
    { code:'KR-26-110', name:'ì¤‘êµ¬', L3count:11, residents:31, sos:0 },
    { code:'KR-26-140', name:'ì„œêµ¬', L3count:19, residents:55, sos:0 },
  ],
  'KR-27': [
    { code:'KR-27-110', name:'ì¤‘êµ¬', L3count:7, residents:28, sos:0 },
  ],
  'KR-29-110': [
    { code:'KR-29-110-010', name:'ì¤‘í¥ë™', residents:18, sos:1, officer:'ê¹€ë¯¼ìˆ˜ ì£¼ì„' },
    { code:'KR-29-110-020', name:'ìš´ì•”ë™', residents:14, sos:0, officer:'ì´ì§€ì˜ ì£¼ì„' },
    { code:'KR-29-110-030', name:'ìš©ë´‰ë™', residents:11, sos:0, officer:'ë°•ì¤€í˜ ì£¼ì„' },
    { code:'KR-29-110-040', name:'ë¬¸í¥ë™', residents:16, sos:0, officer:'ìµœìˆ˜ë¯¼ ì£¼ì„' },
    { code:'KR-29-110-050', name:'ì¼ê³¡ë™', residents:22, sos:0, officer:'ì •ë‹¤ì€ ì£¼ì„' },
    { code:'KR-29-110-060', name:'ë‘ì•”ë™', residents:9, sos:0, officer:'í•œìƒìš° ì£¼ì„' },
  ],
  'KR-46-380': [
    { code:'KR-46-380-340', name:'ëŒ€ì „ë©´', residents:12, sos:0, officer:'ì˜¤ì„±ë¹ˆ ì£¼ì„' },
    { code:'KR-46-380-350', name:'ë´‰ì‚°ë©´', residents:8, sos:0, officer:'ìœ¤ë¯¸ë˜ ì£¼ì„' },
    { code:'KR-46-380-360', name:'ê¸ˆì„±ë©´', residents:7, sos:0, officer:'ì¡°í˜„ì„œ ì£¼ì„' },
  ],
};

// Dummy residents per dong
const residents = {
  'KR-29-110-010': [
    { id:'AJS-GJ-NK-001', name:'ê¹€â—‹ìˆ™', phone:'010-****-1234', addr:'ê´‘ì£¼ ë¶êµ¬ ì¤‘í¥ë¡œ 42, 101í˜¸', reg:'2024.03.15', lastSOS:'2025.07.21 09:12', status:'sos', x:52, y:38 },
    { id:'AJS-GJ-NK-002', name:'ë°•â—‹ë‚¨', phone:'010-****-5678', addr:'ê´‘ì£¼ ë¶êµ¬ ì¤‘í¥ë¡œ 88, 203í˜¸', reg:'2024.04.02', lastSOS:'ì—†ìŒ', status:'normal', x:30, y:55 },
    { id:'AJS-GJ-NK-003', name:'ì´â—‹ì', phone:'010-****-9012', addr:'ê´‘ì£¼ ë¶êµ¬ ë¶ë¬¸ëŒ€ë¡œ 12', reg:'2024.04.20', lastSOS:'2025.05.10', status:'normal', x:68, y:62 },
    { id:'AJS-GJ-NK-004', name:'ìµœâ—‹í˜¸', phone:'010-****-3456', addr:'ê´‘ì£¼ ë¶êµ¬ ìš©ë´‰ë¡œ 15', reg:'2024.05.01', lastSOS:'ì—†ìŒ', status:'normal', x:45, y:72 },
    { id:'AJS-GJ-NK-005', name:'ì •â—‹í¬', phone:'010-****-7890', addr:'ê´‘ì£¼ ë¶êµ¬ ì¤‘í¥ë¡œ 200', reg:'2024.05.15', lastSOS:'ì—†ìŒ', status:'warning', x:22, y:35 },
    { id:'AJS-GJ-NK-006', name:'ìœ¤â—‹ì² ', phone:'010-****-2345', addr:'ê´‘ì£¼ ë¶êµ¬ ë™ë¬¸ëŒ€ë¡œ 55', reg:'2024.06.01', lastSOS:'ì—†ìŒ', status:'normal', x:75, y:40 },
    { id:'AJS-GJ-NK-007', name:'ê°•â—‹ìˆœ', phone:'010-****-6789', addr:'ê´‘ì£¼ ë¶êµ¬ ì„œë¬¸ë¡œ 8', reg:'2024.06.20', lastSOS:'ì—†ìŒ', status:'normal', x:58, y:20 },
    { id:'AJS-GJ-NK-008', name:'ì¡°â—‹ë¯¼', phone:'010-****-0123', addr:'ê´‘ì£¼ ë¶êµ¬ ì¤‘í¥ë¡œ 310', reg:'2024.07.05', lastSOS:'ì—†ìŒ', status:'normal', x:35, y:25 },
    { id:'AJS-GJ-NK-009', name:'ì„â—‹ê²½', phone:'010-****-4567', addr:'ê´‘ì£¼ ë¶êµ¬ ì„ë™ 22', reg:'2024.07.22', lastSOS:'ì—†ìŒ', status:'normal', x:80, y:65 },
    { id:'AJS-GJ-NK-010', name:'ì˜¤â—‹ì§„', phone:'010-****-8901', addr:'ê´‘ì£¼ ë¶êµ¬ ìš°ì¹˜ë¡œ 100', reg:'2024.08.01', lastSOS:'ì—†ìŒ', status:'normal', x:15, y:60 },
    { id:'AJS-GJ-NK-011', name:'í•œâ—‹ë¯¸', phone:'010-****-2222', addr:'ê´‘ì£¼ ë¶êµ¬ ì¤‘í¥ë¡œ 44', reg:'2024.08.10', lastSOS:'ì—†ìŒ', status:'normal', x:55, y:80 },
    { id:'AJS-GJ-NK-012', name:'ì„œâ—‹ë³µ', phone:'010-****-3333', addr:'ê´‘ì£¼ ë¶êµ¬ ìš´ì•”ë¡œ 7', reg:'2024.09.01', lastSOS:'ì—†ìŒ', status:'normal', x:42, y:45 },
    { id:'AJS-GJ-NK-013', name:'ì¥â—‹ê¸°', phone:'010-****-4444', addr:'ê´‘ì£¼ ë¶êµ¬ ë¬¸í¥ë¡œ 33', reg:'2024.09.15', lastSOS:'ì—†ìŒ', status:'normal', x:70, y:28 },
    { id:'AJS-GJ-NK-014', name:'í™©â—‹ë‹˜', phone:'010-****-5555', addr:'ê´‘ì£¼ ë¶êµ¬ ì¼ê³¡ë¡œ 9', reg:'2024.10.01', lastSOS:'ì—†ìŒ', status:'normal', x:25, y:75 },
    { id:'AJS-GJ-NK-015', name:'ë…¸â—‹ìˆ˜', phone:'010-****-6666', addr:'ê´‘ì£¼ ë¶êµ¬ ë¶ë¬¸ëŒ€ë¡œ 65', reg:'2024.10.20', lastSOS:'ì—†ìŒ', status:'normal', x:62, y:50 },
    { id:'AJS-GJ-NK-016', name:'ì‹¬â—‹ë€', phone:'010-****-7777', addr:'ê´‘ì£¼ ë¶êµ¬ ìš©ë´‰ë¡œ 88', reg:'2024.11.01', lastSOS:'ì—†ìŒ', status:'normal', x:38, y:65 },
    { id:'AJS-GJ-NK-017', name:'ë¬¸â—‹í™˜', phone:'010-****-8888', addr:'ê´‘ì£¼ ë¶êµ¬ ì¤‘í¥ë¡œ 155', reg:'2024.11.15', lastSOS:'ì—†ìŒ', status:'normal', x:82, y:50 },
    { id:'AJS-GJ-NK-018', name:'ê¶Œâ—‹í˜„', phone:'010-****-9999', addr:'ê´‘ì£¼ ë¶êµ¬ ìš°ì¹˜ë¡œ 44', reg:'2024.12.01', lastSOS:'ì—†ìŒ', status:'normal', x:18, y:45 },
  ]
};

// â”€â”€â”€ NAV STATE â”€â”€â”€
let currentLevel = 0;
let selectedPath = [];
let allCards = [];
let currentFilter = 'all';
let sideTabFilter = 'all';
let currentResidents = [];
let selectedResident = null;

function buildCards(data) {
  allCards = data;
  renderCards(data);
}

function renderCards(data) {
  const grid = document.getElementById('navGrid');
  const count = document.getElementById('panelCount');
  count.textContent = `${data.length}ê°œ êµ¬ì—­`;
  grid.innerHTML = '';
  data.forEach(item => {
    const card = document.createElement('div');
    card.className = 'nav-card' + (item.sos > 0 ? ' has-sos' : '');
    const levelInfo = item.L2count ? `í•˜ìœ„ ${item.L2count}ê°œ êµ¬ì—­` : item.L3count ? `í•˜ìœ„ ${item.L3count}ê°œ ìÂ·ë©´Â·ë™` : `ë‹´ë‹¹: ${item.officer || 'ë¯¸ë°°ì •'}`;
    card.innerHTML = `
      <div class="card-label">${item.name}</div>
      <div class="card-sub">${item.code}</div>
      <div class="card-stats">
        <span class="stat-pill stat-blue">${item.residents}ëª…</span>
        ${item.sos > 0 ? `<span class="stat-pill stat-red">SOS ${item.sos}</span>` : '<span class="stat-pill stat-green">ì •ìƒ</span>'}
      </div>
      <div style="font-size:10px;color:var(--text2);margin-top:6px;">${levelInfo}</div>
      <div class="card-arrow">â€º</div>
    `;
    card.onclick = () => drillDown(item);
    grid.appendChild(card);
  });
}

function filterCards() {
  const q = document.getElementById('navSearch').value.toLowerCase();
  renderCards(allCards.filter(c => c.name.toLowerCase().includes(q) || c.code.toLowerCase().includes(q)));
}

// Initial
buildCards(hierarchy.L1);
document.getElementById('panelTitle').textContent = 'ì‹œÂ·ë„ ì„ íƒ';
document.getElementById('navSearch').placeholder = 'ì‹œÂ·ë„ëª… ê²€ìƒ‰...';

// Show SOS toast after 1s
setTimeout(() => { document.getElementById('sosToast').classList.add('visible'); }, 1000);

function drillDown(item) {
  const code = item.code;
  
  // L3 â€” go to radar
  if (currentLevel === 2) {
    openRadar(item);
    return;
  }

  selectedPath.push(item);
  currentLevel++;
  
  // Update breadcrumb
  updateBreadcrumb();

  // Update tabs
  ['tabL0','tabL1','tabL2','tabL3'].forEach((id, i) => {
    const el = document.getElementById(id);
    el.classList.toggle('active', i === currentLevel);
    if (i <= currentLevel) { el.style.opacity='1'; el.style.pointerEvents='auto'; }
  });

  if (currentLevel === 3) {
    // Go to L3 radar directly
    openRadar(item);
    return;
  }

  const nextData = hierarchy[code] || [];
  const titles = ['', 'ì‹œÂ·ë„ ì„ íƒ', 'ì‹œÂ·êµ°Â·êµ¬ ì„ íƒ', 'ìÂ·ë©´Â·ë™ ì„ íƒ'];
  const placeholders = ['', 'ì‹œÂ·ë„ëª… ê²€ìƒ‰...', 'ì‹œÂ·êµ°Â·êµ¬ëª… ê²€ìƒ‰...', 'ìÂ·ë©´Â·ë™ëª… ê²€ìƒ‰...'];
  document.getElementById('panelTitle').textContent = `${item.name} â€” ${titles[currentLevel]}`;
  document.getElementById('navSearch').value = '';
  document.getElementById('navSearch').placeholder = placeholders[currentLevel];
  buildCards(nextData);
}

function drillTo(level) {
  if (level >= currentLevel) return;
  if (level === 0) {
    currentLevel = 0;
    selectedPath = [];
    buildCards(hierarchy.L1);
    document.getElementById('panelTitle').textContent = 'ì‹œÂ·ë„ ì„ íƒ';
    document.getElementById('navSearch').placeholder = 'ì‹œÂ·ë„ëª… ê²€ìƒ‰...';
    document.getElementById('navSearch').value = '';
    ['tabL1','tabL2','tabL3'].forEach(id => { const el = document.getElementById(id); el.style.opacity='0.3'; el.style.pointerEvents='none'; });
    document.getElementById('tabL0').classList.add('active');
  } else if (level === 1) {
    currentLevel = 1;
    selectedPath = [selectedPath[0]];
    const code = selectedPath[0].code;
    buildCards(hierarchy[code] || []);
    document.getElementById('panelTitle').textContent = `${selectedPath[0].name} â€” ì‹œÂ·êµ°Â·êµ¬ ì„ íƒ`;
    document.getElementById('navSearch').value = '';
    ['tabL2','tabL3'].forEach(id => { const el = document.getElementById(id); el.style.opacity='0.3'; el.style.pointerEvents='none'; });
  } else if (level === 2) {
    currentLevel = 2;
    selectedPath = selectedPath.slice(0,2);
    const code = selectedPath[1].code;
    buildCards(hierarchy[code] || []);
    document.getElementById('panelTitle').textContent = `${selectedPath[1].name} â€” ìÂ·ë©´Â·ë™ ì„ íƒ`;
    document.getElementById('navSearch').value = '';
    document.getElementById('tabL3').style.opacity='0.3'; document.getElementById('tabL3').style.pointerEvents='none';
  }
  updateBreadcrumb();
}

function updateBreadcrumb() {
  const items = ['bc1','bc2','bc3']; const seps = ['bcSep1','bcSep2','bcSep3'];
  items.forEach((id, i) => {
    const el = document.getElementById(id); const sep = document.getElementById(seps[i]);
    if (selectedPath[i]) { el.textContent = selectedPath[i].name; el.style.display=''; sep.style.display=''; }
    else { el.style.display='none'; sep.style.display='none'; }
  });
  ['bc0','bc1','bc2','bc3'].forEach((id,i) => {
    const el = document.getElementById(id);
    if (el) el.classList.toggle('active', i === currentLevel);
  });
}

// â”€â”€â”€ RADAR â”€â”€â”€
function openRadar(item) {
  const code = item.code;
  const dongName = item.name;
  
  // Set radar titles
  document.getElementById('radarTitle').textContent = `${dongName} ìŠ¤ë§ˆíŠ¸ ì•ˆì‹¬ ë„¤íŠ¸ì›Œí¬`;
  document.getElementById('radarBC3').textContent = dongName;
  if (selectedPath[0]) document.getElementById('radarBC1').textContent = selectedPath[0].name;
  if (selectedPath[1]) document.getElementById('radarBC2').textContent = selectedPath[1].name;

  // Load residents
  currentResidents = residents[code] || generateDummyResidents(code, item.residents || 8);
  
  // Transition
  const nav = document.getElementById('navScreen');
  const radar = document.getElementById('radarScreen');
  nav.classList.add('slide-out');
  setTimeout(() => {
    nav.classList.remove('active','slide-out');
    radar.classList.add('active','slide-in');
    setTimeout(() => radar.classList.remove('slide-in'), 400);
    renderRadar();
    renderSidebar();
    updateScaleLabel();
  }, 300);
}

function generateDummyResidents(code, count) {
  const statuses = ['normal','normal','normal','normal','normal','warning'];
  const surnames = ['ê¹€','ì´','ë°•','ìµœ','ì •','ê°•','ì¡°','ìœ¤','ì„','í•œ','ì˜¤','ì„œ'];
  const res = [];
  for (let i = 0; i < count; i++) {
    const sur = surnames[i % surnames.length];
    const angle = (Math.PI * 2 * i) / count;
    const r = 20 + Math.random() * 55;
    res.push({
      id: `AJS-${code.slice(-6).replace(/-/g,'')}-${String(i+1).padStart(3,'0')}`,
      name: `${sur}â—‹${['ìˆ˜','ë¯¸','ì','í˜¸','ìˆœ','ì² ','í¬','ë¯¼'][i%8]}`,
      phone: `010-****-${String(1000+i*137).slice(-4)}`,
      addr: `í•´ë‹¹ êµ¬ì—­ ${100+i*7}ë²ˆì§€`,
      reg: `2024.${String((i%12)+1).padStart(2,'0')}.${String((i%28)+1).padStart(2,'0')}`,
      lastSOS: 'ì—†ìŒ',
      status: statuses[i % statuses.length],
      x: 50 + r * Math.cos(angle) * 0.7,
      y: 50 + r * Math.sin(angle) * 0.7,
    });
  }
  return res;
}

function renderRadar() {
  const wrap = document.getElementById('radarWrap');
  // Remove old dots
  wrap.querySelectorAll('.radar-dot').forEach(d => d.remove());
  
  const filtered = getFilteredResidents();
  
  filtered.forEach(r => {
    const dot = document.createElement('div');
    dot.className = `radar-dot dot-${r.status}`;
    dot.style.left = r.x + '%';
    dot.style.top = r.y + '%';
    
    const tip = document.createElement('div');
    tip.className = 'dot-tooltip';
    tip.innerHTML = `<b>${r.name}</b><br><span style="font-family:var(--mono);font-size:10px;color:var(--text2)">${r.id}</span><br><span style="font-size:10px;">${r.addr.slice(0,20)}...</span>`;
    dot.appendChild(tip);
    
    dot.onclick = () => openDetail(r);
    wrap.appendChild(dot);
  });
}

function renderSidebar() {
  const list = document.getElementById('rsList');
  const count = document.getElementById('sidebarCount');
  const filtered = getSideFiltered();
  count.textContent = `${filtered.length}ëª…`;
  
  if (filtered.length === 0) {
    list.innerHTML = '<div class="rs-empty">í•´ë‹¹ ì¡°ê±´ì˜ ì–´ë¥´ì‹ ì´ ì—†ìŠµë‹ˆë‹¤</div>';
    return;
  }
  
  // SOS first
  const sorted = [...filtered].sort((a,b) => (a.status==='sos'?-1:b.status==='sos'?1:0));
  list.innerHTML = sorted.map(r => `
    <div class="res-card ${r.status==='sos'?'sos-card':''}" onclick="openDetail(currentResidents.find(x=>x.id==='${r.id}'))">
      <div class="res-header-row">
        <span class="res-name">${r.name}</span>
        <span class="res-status ${r.status==='sos'?'stat-red':r.status==='warning'?'stat-pill':'stat-green'}" 
          style="${r.status==='sos'?'background:rgba(255,51,51,0.2);color:#ff6666;border:1px solid rgba(255,51,51,0.4);border-radius:10px;font-family:var(--mono);font-size:9px;font-weight:700;padding:2px 7px;':r.status==='warning'?'background:rgba(255,204,0,0.15);color:var(--yellow);border:1px solid rgba(255,204,0,0.3);border-radius:10px;font-family:var(--mono);font-size:9px;font-weight:700;padding:2px 7px;':'background:rgba(0,255,136,0.1);color:var(--green);border:1px solid rgba(0,255,136,0.2);border-radius:10px;font-family:var(--mono);font-size:9px;font-weight:700;padding:2px 7px;'}">
          ${r.status==='sos'?'SOS':r.status==='warning'?'ì£¼ì˜':'ì •ìƒ'}
        </span>
      </div>
      <div class="res-id">${r.id}</div>
      <div class="res-addr">${r.addr.slice(0,24)}${r.addr.length>24?'...':''}</div>
    </div>
  `).join('');
}

function getFilteredResidents() {
  let list = currentResidents;
  const q = document.getElementById('radarSearch').value.toLowerCase();
  if (q) list = list.filter(r => r.name.replace('â—‹','').includes(q) || r.phone.includes(q) || r.id.toLowerCase().includes(q));
  if (currentFilter === 'sos') list = list.filter(r => r.status === 'sos');
  if (currentFilter === 'normal') list = list.filter(r => r.status === 'normal');
  return list;
}

function getSideFiltered() {
  let list = currentResidents;
  const q = document.getElementById('radarSearch').value.toLowerCase();
  if (q) list = list.filter(r => r.name.replace('â—‹','').includes(q) || r.phone.includes(q) || r.id.toLowerCase().includes(q));
  if (sideTabFilter === 'sos') list = list.filter(r => r.status === 'sos');
  if (sideTabFilter === 'normal') list = list.filter(r => r.status === 'normal');
  return list;
}

function setFilter(f) {
  currentFilter = f;
  ['btnAll','btnSOS','btnNormal'].forEach(id => document.getElementById(id).classList.remove('active'));
  document.getElementById(f==='all'?'btnAll':f==='sos'?'btnSOS':'btnNormal').classList.add('active');
  renderRadar();
}

function setSideTab(f) {
  sideTabFilter = f;
  document.querySelectorAll('.rs-tab').forEach((el, i) => el.classList.toggle('active', ['all','sos','normal'][i]===f));
  renderSidebar();
}

function filterDots() { renderRadar(); renderSidebar(); }

function updateScaleLabel() {
  const n = currentResidents.length;
  const label = n <= 20 ? 'ëŒ€í˜• (28dp) Â· ìë™ ìŠ¤ì¼€ì¼' : n <= 50 ? 'ì¤‘í˜• (20dp) Â· ìë™ ìŠ¤ì¼€ì¼' : 'ì†Œí˜• (14dp) Â· ê¸°ì¤€ ë°€ë„';
  document.getElementById('scaleLabel').textContent = `ğŸ‘¥ ${n}ëª… Â· ${label}`;
}

function openDetail(r) {
  if (!r) return;
  selectedResident = r;
  document.getElementById('dcName').textContent = r.name;
  document.getElementById('dcId').textContent = r.id;
  const statusMap = { sos:'ğŸš¨ SOS ì§„í–‰ ì¤‘', normal:'âœ… ì •ìƒ', warning:'âš  ì£¼ì˜ ê´€ì°°' };
  document.getElementById('dcStatus').innerHTML = `<span style="font-weight:700;color:${r.status==='sos'?'#ff6666':r.status==='warning'?'var(--yellow)':'var(--green)'}">${statusMap[r.status]||r.status}</span>`;
  document.getElementById('dcPhone').textContent = r.phone;
  document.getElementById('dcAddr').textContent = r.addr;
  document.getElementById('dcReg').textContent = r.reg;
  document.getElementById('dcLastSOS').textContent = r.lastSOS;
  document.getElementById('detailPopup').classList.add('visible');
}

function closeDetail() { document.getElementById('detailPopup').classList.remove('visible'); }

function confirmDisconnect() {
  if (!selectedResident) return;
  if (confirm(`âš ï¸ ${selectedResident.name}ë‹˜ì˜ ê´€ë¦¬ ì—°ê²°ì„ í•´ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\ní•´ì œ ì¦‰ì‹œ ë ˆì´ë”ì—ì„œ ì œê±°ë˜ë©° ìœ„ì¹˜ ê³µìœ  ë™ì˜ê°€ ì² íšŒë©ë‹ˆë‹¤.`)) {
    currentResidents = currentResidents.filter(r => r.id !== selectedResident.id);
    closeDetail();
    renderRadar();
    renderSidebar();
    updateScaleLabel();
    alert(`âœ… ${selectedResident.name}ë‹˜ì˜ ì—°ê²°ì´ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
  }
}

function goToSOS() {
  // Navigate directly to ì¤‘í¥ë™
  selectedPath = [hierarchy.L1[0], hierarchy['KR-29'][0]];
  currentLevel = 2;
  updateBreadcrumb();
  openRadar({ code:'KR-29-110-010', name:'ì¤‘í¥ë™', residents:18, sos:1 });
  document.getElementById('sosToast').classList.remove('visible');
}

function goBack() {
  const nav = document.getElementById('navScreen');
  const radar = document.getElementById('radarScreen');
  radar.classList.add('slide-out');
  setTimeout(() => {
    radar.classList.remove('active','slide-out');
    nav.classList.add('active','slide-in');
    setTimeout(() => nav.classList.remove('slide-in'), 400);
  }, 280);
}

// Close popup on backdrop click
document.getElementById('detailPopup').addEventListener('click', function(e) {
  if (e.target === this) closeDetail();
});
</script>
</body>
</html>
