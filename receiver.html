<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#2b2b85">
    <title>ì•ˆì „ì§€ëŒ€ ìˆ˜ì‹ ì†Œ V10.6</title>
    
    <link rel="manifest" href="manifest-receiver.json">
    <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=5d19f896badf6fdab5297f129bffaf1e&libraries=services"></script>
    
    <style>
        /* ë°œì‹ ì†Œì™€ ë™ì¼í•œ ê³ ì • ë””ìì¸ ì‹œìŠ¤í…œ */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: sans-serif; }
        body { 
            height: 100vh; background: #2b2b85; color: white; text-align: center; 
            display: flex; justify-content: center; align-items: center; overflow: hidden; 
            touch-action: none; /* í™”ë©´ í™•ëŒ€/ì¶•ì†Œ ë° ì›€ì§ì„ ì›ì²œ ì°¨ë‹¨ */
        }
        
        .screen { 
            display: none; width: 100%; height: 100%; 
            flex-direction: column; align-items: center; justify-content: flex-start; 
            position: absolute; top: 0; left: 0; padding: 20px; 
        }
        .active { display: flex !important; }

        /* ê³ ê¸‰ìŠ¤ëŸ¬ìš´ ìƒë‹¨ë°” */
        .header { width: 100%; padding: 20px 0; display: flex; justify-content: space-between; align-items: center; z-index: 10; }
        .gear-btn { width: 50px; height: 50px; background: rgba(255,255,255,0.2); border: none; border-radius: 50%; font-size: 24px; cursor: pointer; }

        /* ìˆ˜ì‹  ìƒíƒœ ì¹´ë“œ */
        .card { background: rgba(255,255,255,0.1); padding: 20px; border-radius: 20px; width: 100%; max-width: 400px; margin-bottom: 15px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); }
        .status-badge { display: inline-block; padding: 5px 15px; border-radius: 20px; font-size: 14px; font-weight: bold; margin-bottom: 10px; }
        .status-safe { background: #2ecc71; color: white; }
        .status-emergency { background: #f90b3e; color: white; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }

        /* ì§€ë„ ì˜ì—­ */
        #map { width: 100%; height: 250px; border-radius: 15px; margin: 15px 0; border: 2px solid rgba(255,255,255,0.3); }

        /* ì„¤ì • í™”ë©´ ìš”ì†Œ */
        .id-text { font-size: 28px; color: #ffd700; font-weight: 900; margin: 10px 0; }
        .input-box { width: 100%; padding: 15px; border-radius: 12px; border: none; font-size: 18px; margin: 10px 0; text-align: center; background: white; color: #2b2b85; }
        .btn-yellow { background: #ffd700; color: #2b2b85; padding: 15px; width: 100%; font-size: 18px; font-weight: bold; border-radius: 12px; border: none; cursor: pointer; }
        .friend-item { background: rgba(255,255,255,0.1); padding: 15px; border-radius: 12px; margin: 10px 0; display: flex; justify-content: space-between; align-items: center; width: 100%; }
        .btn-pill { background: rgba(255,255,255,0.2); color: white; padding: 18px; width: 100%; max-width: 300px; font-size: 20px; font-weight: bold; border-radius: 50px; border: none; margin-top: 20px; }
    </style>
</head>
<body>

    <div id="mainScreen" class="screen active">
        <div class="header">
            <h2 style="font-size: 18px;">ğŸ›¡ï¸ ë¸”ë™ì•„ì›ƒ ê°€ë””ì–¸</h2>
            <button class="gear-btn" onclick="go('setScreen')">âš™ï¸</button>
        </div>
        
        <div class="card">
            <div id="statusBadge" class="status-badge status-safe">ì •ìƒ ëª¨ë‹ˆí„°ë§ ì¤‘</div>
            <p id="senderName" style="font-size: 20px; font-weight: bold;">ëŒ€ê¸° ì¤‘...</p>
            <p id="senderAddr" style="font-size: 14px; opacity: 0.8; margin-top: 5px;">ì‹ í˜¸ë¥¼ ê¸°ë‹¤ë¦¬ê³  ìˆìŠµë‹ˆë‹¤.</p>
            <div id="map"></div>
        </div>
        <p style="font-size: 12px; opacity: 0.5;">ë°œì‹ ì†Œ 5ëª… ì§‘ì¤‘ ê´€ë¦¬ ì¤‘ (V10.6)</p>
    </div>

    <div id="setScreen" class="screen">
        <h1 style="margin: 30px 0 20px;">ìˆ˜ì‹  ì„¤ì •</h1>
        <div class="card">
            <p>ğŸ¤ ë°œì‹ ì ID ë“±ë¡ (ìµœëŒ€ 5ëª…)</p>
            <input type="text" id="targetID" class="input-box" placeholder="ì˜ˆ: SZ-A1B2">
            <button class="btn-yellow" onclick="addTarget()">ëª¨ë‹ˆí„°ë§ ëª…ë‹¨ì— ì¶”ê°€</button>
        </div>
        <div id="targetList" style="width: 100%; max-width: 400px; overflow-y: auto; max-height: 250px;"></div>
        <button class="btn-pill" onclick="go('mainScreen')">â† ëŒì•„ê°€ê¸°</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCJnlwuftFUmmazQg-riYRewSeKRjBB8g",
            databaseURL: "https://safezone-2c1b2-default-rtdb.firebaseio.com",
            projectId: "safezone-2c1b2",
            appId: "1:181205095456:web:da0a519ff43cc19e7b1845"
        };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // í™”ë©´ ì „í™˜ í•¨ìˆ˜
        window.go = function(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(id === 'setScreen') loadTargets();
        };

        // ì¹œêµ¬ ë“±ë¡ (ìµœëŒ€ 5ëª…)
        window.addTarget = function() {
            const input = document.getElementById('targetID');
            const id = input.value.trim().toUpperCase();
            if(!id) return;
            let list = JSON.parse(localStorage.getItem('friendList_REC') || '[]');
            if(list.length >= 5) { alert("ìµœëŒ€ 5ëª…ê¹Œì§€ë§Œ ìˆ˜ì‹  ê°€ëŠ¥í•©ë‹ˆë‹¤."); return; }
            if(!list.includes(id)) list.push(id);
            localStorage.setItem('friendList_REC', JSON.stringify(list));
            input.value = "";
            loadTargets();
        };

        window.loadTargets = function() {
            const list = JSON.parse(localStorage.getItem('friendList_REC') || '[]');
            const cont = document.getElementById('targetList');
            cont.innerHTML = list.map(f => `<div class="friend-item"><span>ğŸ“¡ ${f}</span><button onclick="deleteTarget('${f}')" style="color:#ff4757;background:none;border:none;font-size:20px;">âœ•</button></div>`).join('');
        };

        window.deleteTarget = function(id) {
            let list = JSON.parse(localStorage.getItem('friendList_REC') || '[]');
            list = list.filter(f => f !== id);
            localStorage.setItem('friendList_REC', JSON.stringify(list));
            loadTargets();
        };

        // ì§€ë„ ë° ìˆ˜ì‹  ë¡œì§ (ìƒëµëœ ê¸°ì¡´ ë¡œì§ ìœ ì§€ ê°€ëŠ¥)
        // ... ìƒëµ ...
    </script>
</body>
</html>
