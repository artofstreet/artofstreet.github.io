<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•ˆì „ì§€ëŒ€ ìˆ˜ì‹ ì†Œ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: sans-serif; }
        body { height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; text-align: center; transition: background 0.5s; padding: 20px; }
        
        .safe { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
        .emergency { background: linear-gradient(135deg, #ff0844 0%, #ff4757 100%); animation: blink 1s infinite alternate; }
        @keyframes blink { from { opacity: 1; } to { opacity: 0.8; } }

        h1 { font-size: 40px; margin-bottom: 20px; font-weight: 900; }
        p { font-size: 24px; margin: 10px 0; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px; width: 100%; max-width: 400px; }
        
        #resetBtn {
            display: none; 
            margin-top: 30px; padding: 20px 40px; font-size: 24px; font-weight: bold;
            color: #ff4757; background: white; border: none; border-radius: 50px;
            cursor: pointer; box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body id="bg" class="safe">

    <h1 id="statusText">âœ… í˜„ì¬ ì•ˆì „í•©ë‹ˆë‹¤</h1>
    <p id="timeText">ëŒ€ê¸° ì¤‘...</p>
    <p id="msgText">ìˆ˜ì‹  ëŒ€ê¸° ì¤‘</p>

    <button id="resetBtn" onclick="resetEmergency()">ìƒí™© ì¢…ë£Œ (ì´ˆê¸°í™”)</button>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
        import { getDatabase, ref, onValue, remove } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

        // ì§„ì§œ ë§ˆìŠ¤í„°í‚¤!
        const firebaseConfig = {
            apiKey: "AIzaSyCJnlwuftFUmmazQg-riYRewSeKRjBB8g",
            authDomain: "safezone-2c1b2.firebaseapp.com",
            databaseURL: "https://safezone-2c1b2-default-rtdb.firebaseio.com",
            projectId: "safezone-2c1b2",
            storageBucket: "safezone-2c1b2.firebasestorage.app",
            messagingSenderId: "181205095456",
            appId: "1:181205095456:web:da0a519ff43cc19e7b1845",
            measurementId: "G-X6QBMSL7DS"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const emergencyRef = ref(database, 'emergency_signal');

        // [ì‹¤ì‹œê°„ ê°ì‹œ] í™•ì¸ ì°½(alert) ì™„ì „ ì‚­ì œ! ì†Œë¦¬ë§Œ ë‚©ë‹ˆë‹¤!
        onValue(emergencyRef, (snapshot) => {
            const data = snapshot.val();
            
            if (data) {
                // í™”ë©´ ë¹¨ê°›ê²Œ ë°”ê¾¸ê¸°
                document.getElementById('statusText').innerText = "ğŸš¨ ê¸´ê¸‰ ìƒí™© ë°œìƒ!!";
                document.getElementById('timeText').innerText = "ì‹œê°„: " + data.time;
                document.getElementById('msgText').innerText = data.message;
                document.getElementById('bg').className = "emergency";
                document.getElementById('resetBtn').style.display = "block"; 

                // ğŸ”Š ìš°ë ì°¬ AI ì„±ìš° ëª©ì†Œë¦¬ë§Œ ë°œì‚¬! (í™•ì¸ ì°½ ì—†ìŒ!)
                const ut = new SpeechSynthesisUtterance("ì‚ë½€ì‚ë½€! ì¥í™”ë‹˜ì˜ êµ¬ì¡° ìš”ì²­ì´ ë“¤ì–´ì™”ìŠµë‹ˆë‹¤!");
                ut.lang = 'ko-KR';
                window.speechSynthesis.speak(ut);

            } else {
                // ì´ˆë¡ìƒ‰ í‰í™” ìƒíƒœë¡œ ë³µê·€
                document.getElementById('statusText').innerText = "âœ… í˜„ì¬ ì•ˆì „í•©ë‹ˆë‹¤";
                document.getElementById('timeText').innerText = "ëŒ€ê¸° ì¤‘...";
                document.getElementById('msgText').innerText = "ìˆ˜ì‹  ëŒ€ê¸° ì¤‘";
                document.getElementById('bg').className = "safe";
                document.getElementById('resetBtn').style.display = "none"; 
            }
        });

        // ìƒí™© ì¢…ë£Œ ê¸°ëŠ¥
        window.resetEmergency = function() {
            remove(emergencyRef); 
        };
    </script>
</body>
</html>
