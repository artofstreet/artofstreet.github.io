<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•ˆì „ì§€ëŒ€ ìˆ˜ì‹ ì†Œ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: sans-serif; }
        body { height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; text-align: center; transition: background 0.5s; padding: 20px; }
        
        /* í‰ìƒì‹œ (ì´ˆë¡ìƒ‰ ì•ˆì „ì§€ëŒ€) */
        .safe { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
        
        /* ê¸´ê¸‰ìƒí™© (ë¹¨ê°„ìƒ‰ ë¹„ìƒë²¨) */
        .emergency { background: linear-gradient(135deg, #ff0844 0%, #ff4757 100%); animation: blink 1s infinite alternate; }
        @keyframes blink { from { opacity: 1; } to { opacity: 0.8; } }

        h1 { font-size: 40px; margin-bottom: 20px; font-weight: 900; }
        p { font-size: 24px; margin: 10px 0; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px; width: 100%; max-width: 400px; }
        
        /* ìƒí™© ì¢…ë£Œ(ë¦¬ì…‹) ë²„íŠ¼ - í‰ì†Œì—” ìˆ¨ê²¨ë‘ ! */
        #resetBtn {
            display: none; 
            margin-top: 30px;
            padding: 20px 40px;
            font-size: 24px;
            font-weight: bold;
            color: #ff4757;
            background: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body id="bg" class="safe">

    <h1 id="statusText">âœ… í˜„ì¬ ì•ˆì „í•©ë‹ˆë‹¤</h1>
    <p id="timeText">ëŒ€ê¸° ì¤‘...</p>
    <p id="msgText">ìˆ˜ì‹  ëŒ€ê¸° ì¤‘</p>

    <button id="resetBtn" onclick="resetEmergency()">ìƒí™© ì¢…ë£Œ (ì´ˆê¸°í™”)</button>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
        // 'remove' ë¼ëŠ” êµ¬ê¸€ ì§€ìš°ê°œë¥¼ ìƒˆë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤!
        import { getDatabase, ref, onValue, remove } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

        // ì§„ì§œ ë¹„ë°€ ì—´ì‡  ì™„ë²½ ì¥ì°©!
        const firebaseConfig = {
            apiKey: "AIzaSyCJnlwuftFUmmazQg-riYRewSeKRjBB8g",
            authDomain: "safezone-2c1b2.firebaseapp.com",
            databaseURL: "https://safezone-2c1b2-default-rtdb.firebaseio.com",
            projectId: "safezone-2c1b2",
            storageBucket: "safezone-2c1b2.firebasestorage.app",
            messagingSenderId: "181205095456",
            appId: "1:181205095456:web:da0a519ff43cc19e7b1845",
            measurementId: "G-X6QBMSL7DS"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const emergencyRef = ref(database, 'emergency_signal');

        // 1. ì‹¤ì‹œê°„ ê°ì‹œ ê¸°ëŠ¥
        onValue(emergencyRef, (snapshot) => {
            const data = snapshot.val();
            
            if (data) {
                // ì‹ í˜¸ê°€ ë“¤ì–´ì™”ì„ ë•Œ (ë¹¨ê°›ê²Œ ë³€í•˜ê³  ë²„íŠ¼ ë‚˜íƒ€ë‚¨!)
                document.getElementById('statusText').innerText = "ğŸš¨ ê¸´ê¸‰ ìƒí™© ë°œìƒ!!";
                document.getElementById('timeText').innerText = "ì‹œê°„: " + data.time;
                document.getElementById('msgText').innerText = data.message;
                document.getElementById('bg').className = "emergency";
                document.getElementById('resetBtn').style.display = "block"; 

                // ğŸ”Š ìš°ë ì°¬ AI ì„±ìš° ëª©ì†Œë¦¬ ë°œì‚¬!
                const ut = new SpeechSynthesisUtterance("ì‚ë½€ì‚ë½€! ê¸´ê¸‰ ìƒí™© ë°œìƒ! ì¥í™”ë‹˜ì˜ êµ¬ì¡° ìš”ì²­ì´ ë“¤ì–´ì™”ìŠµë‹ˆë‹¤!");
                ut.lang = 'ko-KR';
                window.speechSynthesis.speak(ut);

                // ì•Œë¦¼ì°½ ë„ìš°ê¸° (ë°©ì†¡ ë¬»íˆì§€ ì•Šê²Œ 0.5ì´ˆ ì§€ì—°)
                setTimeout(() => {
                    alert("!!! ì¥í™”ë‹˜ì´ ê¸´ê¸‰ ì‹ í˜¸ë¥¼ ë³´ëƒˆìŠµë‹ˆë‹¤ !!!");
                }, 500);
            } else {
                // ì‹ í˜¸ê°€ ì—†ì„ ë•Œ (ì´ˆë¡ìƒ‰ í‰í™” ìƒíƒœë¡œ ë³µê·€!)
                document.getElementById('statusText').innerText = "âœ… í˜„ì¬ ì•ˆì „í•©ë‹ˆë‹¤";
                document.getElementById('timeText').innerText = "ëŒ€ê¸° ì¤‘...";
                document.getElementById('msgText').innerText = "ìˆ˜ì‹  ëŒ€ê¸° ì¤‘";
                document.getElementById('bg').className = "safe";
                document.getElementById('resetBtn').style.display = "none"; 
            }
        });

        // 2. ìƒí™© ì¢…ë£Œ ê¸°ëŠ¥ (êµ¬ê¸€ ì„œë²„ì—ì„œ ì‹ í˜¸ ì‹¹ ì§€ìš°ê¸°!)
        window.resetEmergency = function() {
            if(confirm("ìƒí™©ì´ ì•ˆì „í•˜ê²Œ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆê¹Œ? ì•ŒëŒì„ í•´ì œí•©ë‹ˆë‹¤.")) {
                remove(emergencyRef); 
            }
        };
    </script>
</body>
</html>
