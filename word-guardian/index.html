<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ìŠ¤ë¥´ì‚¬ë§ˆì˜ ê±´ê°• ë¯¸ì¸ í”„ë¡œì íŠ¸</title>
<link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
<style>
    :root { --primary: #4caf50; --bad: #f44336; }
    body { 
        margin: 0; padding: 0; overflow: hidden; 
        background: #e8f5e9; font-family: 'Jua', sans-serif; touch-action: none;
    }
    #game-view { position: relative; width: 100vw; height: 100vh; z-index: 1; }

    /* ìƒë‹¨ UI */
    #ui-header { 
        position: absolute; top: 15px; left: 50%; transform: translateX(-50%);
        width: 90%; background: white; border-radius: 20px; padding: 10px 15px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1); z-index: 100;
        border: 3px solid #81c784; text-align: center;
        display: flex; justify-content: space-between; align-items: center;
    }
    #score-box { font-size: 20px; color: #2e7d32; }
    #hp-container { width: 120px; height: 15px; background: #eee; border-radius: 10px; overflow: hidden; border: 2px solid #ccc;}
    #hp-bar { width: 100%; height: 100%; background: #66bb6a; transition: width 0.3s; }

    /* --- ìˆ¨ê²¨ì§„ ë³´ìƒ ì´ë¯¸ì§€ ì˜ì—­ (í•µì‹¬ ì¶”ê°€) --- */
    #hidden-reward-area {
        position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
        width: 320px; height: 320px; /* ì •ì‚¬ê°í˜• ì˜ì—­ */
        border-radius: 20px; overflow: hidden;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        z-index: 10; /* ìœ ë‹›ë³´ë‹¤ëŠ” ë’¤ì— */
        background-image: url('https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=600&auto=format&fit=crop'); /* ê±´ê°•í•œ ë¯¸ì†Œ ì´ë¯¸ì§€ (ì˜ˆì‹œ) */
        background-size: cover;
        background-position: center;
        border: 5px solid white;
    }

    /* ë¸”ë¡ ë®ê°œ ê·¸ë¦¬ë“œ */
    #block-overlay {
        position: absolute; inset: 0;
        display: grid;
        grid-template-columns: repeat(8, 1fr); /* 8x8 ê·¸ë¦¬ë“œ */
        grid-template-rows: repeat(8, 1fr);
    }
    .cover-block {
        background: rgba(255, 255, 255, 0.85); /* ë°˜íˆ¬ëª… í°ìƒ‰ ë¸”ë¡ */
        border: 1px solid rgba(0,0,0,0.05);
        transition: all 0.3s ease-out;
    }
    .cover-block.removed {
        transform: scale(0); opacity: 0; /* ì‚¬ë¼ì§€ëŠ” ì• ë‹ˆë©”ì´ì…˜ */
    }
    /* ------------------------------------------ */

    /* ê³¼ì¼/ì±„ì†Œ ìœ ë‹› */
    .unit { position: absolute; cursor: pointer; display: flex; flex-direction: column; align-items: center; z-index: 50; }
    .unit-img { 
        width: 90px; height: 90px; object-fit: contain; 
        filter: drop-shadow(0 8px 10px rgba(0,0,0,0.15));
    }
    .unit-text { background: white; padding: 2px 12px; border-radius: 15px; font-size: 18px; border: 2px solid #81c784; margin-top: -10px; font-weight: bold; color:#333;}

    /* í„°ì§ˆ ë•Œ ì»¤ì§€ëŠ” ì• ë‹ˆë©”ì´ì…˜ */
    .unit.bomb { animation: unit-bomb 0.2s ease-out forwards; }
    @keyframes unit-bomb { to { transform: scale(1.8); opacity: 0; } }

    #start-screen {
        position: absolute; inset: 0; background: rgba(255,255,255,0.95);
        display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 1000;
    }
    #start-btn { 
        padding: 15px 50px; font-size: 30px; background: #4caf50; color: white;
        border: none; border-radius: 50px; cursor: pointer; box-shadow: 0 6px 0 #2e7d32;
    }
</style>
</head>
<body>
<div id="game-view">
    <div id="hidden-reward-area">
        <div id="block-overlay"></div>
    </div>

    <div id="start-screen">
        <h1 style="color:#2e7d32; font-size: 36px; margin-bottom:10px;">ê±´ê°• ë¯¸ì¸ í”„ë¡œì íŠ¸!</h1>
        <p style="text-align:center; color:#555; margin-bottom:30px;">ê±´ê°•í•œ ìŒì‹ì„ ë¨¹ìœ¼ë©´<br>ìˆ¨ê²¨ì§„ ì•„ë¦„ë‹¤ì›€ì´ ë‚˜íƒ€ë‚˜ìš”!</p>
        <button id="start-btn">ë„ì „ ì‹œì‘í•˜ê¸°</button>
    </div>
    <div id="ui-header">
        <div id="score-box">ë‚¨ì€ ë¸”ë¡: <span id="blocks-left">64</span>ê°œ</div>
        <div style="display:flex; align-items:center;">ì²´ë ¥: &nbsp;<div id="hp-container"><div id="hp-bar"></div></div></div>
    </div>
</div>

<script>
    const view = document.getElementById('game-view');
    const blocksLeftNum = document.getElementById('blocks-left');
    const hpBar = document.getElementById('hp-bar');
    const startBtn = document.getElementById('start-btn');
    const startScreen = document.getElementById('start-screen');
    const blockOverlay = document.getElementById('block-overlay');

    let active = false, hp = 100;
    let speed = 3.8;
    let totalBlocks = 64; // 8x8 ê·¸ë¦¬ë“œ
    let blocks = []; // ë¸”ë¡ ìš”ì†Œë“¤ì„ ë‹´ì„ ë°°ì—´

    // ë¸”ë¡ ìƒì„± í•¨ìˆ˜
    function createBlocks() {
        for (let i = 0; i < totalBlocks; i++) {
            const block = document.createElement('div');
            block.className = 'cover-block';
            blockOverlay.appendChild(block);
            blocks.push(block);
        }
        blocksLeftNum.innerText = blocks.length;
    }

    function speak(text) {
        if ('speechSynthesis' in window) {
            window.speechSynthesis.cancel();
            const msg = new SpeechSynthesisUtterance(text);
            msg.lang = 'en-US'; msg.rate = 0.85;
            window.speechSynthesis.speak(msg);
        }
    }

    // ì •í™•í•œ ì´ë¯¸ì§€ ë°ì´í„° (ì´ì „ ë²„ì „ ìœ ì§€)
    const foodData = [
        { en: 'Carrot', img: 'http://googleusercontent.com/image_collection/image_retrieval/6447874835532908462_0', ok: true },
        { en: 'Spinach', img: 'http://googleusercontent.com/image_collection/image_retrieval/6260306705533196163_0', ok: true },
        { en: 'Black Bean', img: 'http://googleusercontent.com/image_collection/image_retrieval/16757207088568247672_0', ok: true },
        { en: 'Broccoli', img: 'http://googleusercontent.com/image_collection/image_retrieval/3293059464306261687_0', ok: true },
        { en: 'Apple', img: 'http://googleusercontent.com/image_collection/image_retrieval/12548435611428520210_0', ok: true },
        { en: 'Candy', img: 'http://googleusercontent.com/image_collection/image_retrieval/3335275741087242965_0', ok: false },
        { en: 'Soda', img: 'http://googleusercontent.com/image_collection/image_retrieval/3398505450309933987_0', ok: false }
    ];

    // ë¸”ë¡ ì œê±° í•¨ìˆ˜ (í•µì‹¬ ë¡œì§)
    function revealBlock() {
        // ì•„ì§ ì œê±°ë˜ì§€ ì•Šì€ ë¸”ë¡ë“¤ë§Œ í•„í„°ë§
        const remainingBlocks = blocks.filter(b => !b.classList.contains('removed'));
        
        if (remainingBlocks.length > 0) {
            // ëœë¤í•œ ë¸”ë¡ í•˜ë‚˜ ì„ íƒí•´ì„œ ì œê±° ì• ë‹ˆë©”ì´ì…˜ ì‹¤í–‰
            const randomIndex = Math.floor(Math.random() * remainingBlocks.length);
            const targetBlock = remainingBlocks[randomIndex];
            targetBlock.classList.add('removed');
            
            // ë‚¨ì€ ê°œìˆ˜ ì—…ë°ì´íŠ¸
            blocksLeftNum.innerText = remainingBlocks.length - 1;

            // ìŠ¹ë¦¬ ì¡°ê±´ í™•ì¸
            if (remainingBlocks.length - 1 === 0) {
                gameWin();
            }
        }
    }

    function spawn() {
        if (!active) return;
        const data = foodData[Math.floor(Math.random() * foodData.length)];
        const unit = document.createElement('div');
        unit.className = 'unit';
        unit.innerHTML = `<img src="${data.img}" class="unit-img"><div class="unit-text">${data.en}</div>`;
        // ì¤‘ì•™ ì´ë¯¸ì§€ ì˜ì—­ì„ ê°€ë¦¬ì§€ ì•Šë„ë¡ ì–‘ì˜†ìœ¼ë¡œ ë–¨ì–´ì§€ê²Œ ìœ„ì¹˜ ì¡°ì •
        const side = Math.random() > 0.5 ? 'left' : 'right';
        let posX;
        if (side === 'left') {
             posX = Math.random() * (window.innerWidth / 2 - 180);
        } else {
             posX = (window.innerWidth / 2 + 180) + Math.random() * (window.innerWidth / 2 - 200);
        }
        unit.style.left = Math.max(10, Math.min(window.innerWidth - 100, posX)) + 'px';

        unit.style.top = '-150px';
        view.appendChild(unit);

        let y = -150;
        function fall() {
            if (!active || unit.classList.contains('bomb')) return;
            y += speed; unit.style.top = y + 'px';
            if (y > window.innerHeight) {
                if (data.ok) { hp -= 10; updateHP(); } // ì¢‹ì€ê±° ë†“ì¹˜ë©´ ì²´ë ¥ ê°ì†Œ
                unit.remove();
            } else { requestAnimationFrame(fall); }
        }

        unit.onpointerdown = (e) => {
            e.stopPropagation();
            if (unit.classList.contains('bomb')) return;
            
            unit.classList.add('bomb');
            speak(data.en);

            if (data.ok) {
                // ê±´ê°•í•œ ìŒì‹ì¼ ë•Œë§Œ ë¸”ë¡ ì œê±°!
                revealBlock();
                hp = Math.min(100, hp + 2);
                if (navigator.vibrate) navigator.vibrate(70); // ì«€ë“í•œ ì§„ë™
            } else {
                hp -= 20;
                if (navigator.vibrate) navigator.vibrate([100, 50, 100]); // ê²½ê³  ì§„ë™
            }
            updateHP();
            setTimeout(() => unit.remove(), 200);
        };
        requestAnimationFrame(fall);
        setTimeout(spawn, Math.max(400, 1300 - ((64 - blocks.filter(b => !b.classList.contains('removed')).length) * 15)));
    }

    function updateHP() {
        hpBar.style.width = hp + "%";
        if (hp <= 0) gameOver();
    }

    function gameOver() {
        active = false;
        alert(`ê²Œì„ ì˜¤ë²„! ê±´ê°• ê´€ë¦¬ì— ì‹¤íŒ¨í–ˆì–´ìš” ã… ã… \në‹¤ì‹œ ë„ì „í•´ë³´ì„¸ìš”!`);
        location.reload();
    }

    function gameWin() {
        active = false;
        // ìŠ¹ë¦¬ ì¶•í•˜ ë©”ì‹œì§€ (ì¡°ê¸ˆ ë’¤ì— ëœ¨ë„ë¡)
        setTimeout(() => {
            if (navigator.vibrate) navigator.vibrate([200, 100, 200, 100, 500]); // ì¶•í•˜ ì§„ë™
            alert(`ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤! ğŸ‰\nê±´ê°•í•œ ì‹ìŠµê´€ìœ¼ë¡œ ì•„ë¦„ë‹¤ì›€ì„ ë˜ì°¾ìœ¼ì…¨ì–´ìš”!`);
            location.reload();
        }, 1000);
    }

    startBtn.onclick = () => {
        if (navigator.vibrate) navigator.vibrate(50);
        createBlocks(); // ê²Œì„ ì‹œì‘ ì‹œ ë¸”ë¡ ìƒì„±
        startScreen.style.display = 'none';
        active = true;
        spawn();
    };
</script>
</body>
</html>
